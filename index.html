<!DOCTYPE html>
<!-- AppGenerique v1.0 — smims909 — github.io -->

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FFFFFF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="description" content="MesHeures : Application gratuite et privée pour artisans. Gérez vos feuilles d'heures et exportez vos rapports Excel sans aucun serveur.">
    <meta name="robots" content="noindex, nofollow">
    <meta property="og:title" content="MesHeures">
    <meta property="og:description" content="Application mobile de gestion des heures de travail.">
    <meta property="og:type" content="website">
    <title>MesHeures</title>

    <style>


        /* ── Poppins embarquée — fonctionne sans connexion internet ── */
        @font-face {
            font-family: 'Poppins';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url('data:font/woff;base64,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') format('woff');
        }
        @font-face {
            font-family: 'Poppins';
            font-style: normal;
            font-weight: 600;
            font-display: swap;
            src: url('data:font/woff;base64,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') format('woff');
        }
        @font-face {
            font-family: 'Poppins';
            font-style: normal;
            font-weight: 700;
            font-display: swap;
            src: url('data:font/woff;base64,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') format('woff');
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* Anti-FOUC : masque le body jusqu'au chargement complet */
        body {
            font-family: 'Poppins', sans-serif;
            background: #E8E8ED;
            padding-bottom: 200px;
            font-size: 16px;
            color: #000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.15s ease;
        }
        body.ready {
            visibility: visible;
            opacity: 1;
        }

        /* HEADER */
        .header {
            background: white;
            border-bottom: 1px solid #E5E5E5;
            padding: 40px 20px 16px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* ── Placeholder "Entreprise" + curseur rouge clignotant ── */
        #companyName::placeholder {
            color: #C8C8CC;
        }

        /* Wrapper pour le curseur superposé */
        .logo-container {
            position: relative;
            text-align: center;
            margin-bottom: 16px;
        }

        /* Curseur rouge clignotant — positionné par JS */
        .company-cursor {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 34px;
            background-color: #FD636B !important;
            border-radius: 2px;
            pointer-events: none;
            animation: cursor-blink 1.1s step-start infinite;
            z-index: 10;
        }

        .company-cursor.hidden {
            display: none;
        }

        @keyframes cursor-blink {
            0%, 100% { opacity: 1; }
            50%       { opacity: 0; }
        }

        .header input {
            width: 100%;
            background: #F8F8F8;
            border: 1px solid #E5E5E5;
            color: #000;
            padding: 12px;
            border-radius: 10px;
            font-size: 15px;
            margin-bottom: 10px;
        }
        .header input::placeholder { color: #8E8E93; }
        .header input:focus { outline: none; border-color: #FD636B; background: white; }

        /* NAVIGATION SEMAINE */
        .week-nav {
            background: white;
            padding: 14px 20px 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: none;
            margin-bottom: 0;
        }

        .week-nav button {
            background: transparent;
            color: #FD636B;
            border: none;
            padding: 8px 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .week-nav button:active { opacity: 0.5; }

        .week-date { font-weight: 600; font-size: 17px; color: #000; font-family: 'Poppins', sans-serif; }

        /* RACCOURCIS JOURS */
        .day-shortcuts {
            background: white;
            padding: 8px 12px 14px 12px;
            display: flex;
            justify-content: space-between;
            gap: 6px;
            border-bottom: 1px solid #E5E5E5;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .day-shortcut {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 4px;
            border-radius: 8px;
            cursor: pointer;
            background: transparent;
            border: none;
            font-family: 'Poppins', sans-serif;
            transition: background 0.15s;
            -webkit-tap-highlight-color: transparent;
        }

        .day-shortcut:active { background: #F5F5F5; }

        .day-shortcut .sc-label {
            font-size: 11px;
            font-weight: 700;
            color: #8E8E93;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .day-shortcut .sc-num {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-top: 1px;
        }

        .day-shortcut.sc-today .sc-label,
        .day-shortcut.sc-today .sc-num {
            color: #FD636B;
        }

        .day-shortcut.sc-today .sc-num {
            background: #FD636B;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* CARTES JOUR */
        .day-card {
            background: white;
            margin: 0 12px 12px 12px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .day-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border-bottom: 1px solid #F0F0F0;
            background: #FAFAFA;
        }

        .day-name { font-size: 18px; font-weight: 600; color: #FD636B; font-family: 'Poppins', sans-serif; }
        .day-date { font-size: 13px; color: #666; font-weight: 500; }

        /* PÉRIODES */
        .period-section {
            background: white;
            padding: 14px 16px;
            border-bottom: 1px solid #F5F5F5;
        }
        .period-section:last-of-type { border-bottom: none; }

        .period-header {
            font-size: 14px;
            font-weight: 600;
            color: #FD636B;
            display: flex;
            align-items: center;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        /* CLIENT ROW */
        .client-row {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            align-items: center;
        }

        .client-row input[type="text"] {
            flex: 1;
            margin-bottom: 0;
        }

        .desc-row, .location-row {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            align-items: center;
        }

        .desc-row input, .location-row input {
            flex: 1;
            margin-bottom: 0;
            height: 44px;
        }

        /* ── AUTOCOMPLETE UNIFIÉ : clients, descriptions, lieux ── */
        /* Wrapper générique : position relative, flex:1 */
        .ac-wrapper {
            position: relative;
            flex: 1;
            min-width: 0;
        }
        .ac-wrapper input {
            width: 100%;
            margin-bottom: 0;
            flex: none;
        }
        /* Anciens wrappers gardés comme alias pour compatibilité */
        .lieu-wrapper { position: relative; flex: 1; }
        .lieu-wrapper input { width: 100%; margin-bottom: 0; height: 44px; }
        .client-input-wrapper { position: relative; flex: 1; }
        .client-input-wrapper input { width: 100%; margin-bottom: 0; flex: none; }

        /* Dropdown commun */
        .ac-suggestions {
            display: none;
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 210;
            overflow: hidden;
            max-height: 220px;
            overflow-y: auto;
        }
        .ac-suggestions.visible { display: block; }

        /* Rétrocompatibilité : ancien lieu et client CSS */
        .lieu-suggestions { display: none; position: absolute; top: calc(100% + 4px); left: 0; right: 0;
            background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 200; overflow: hidden; }
        .lieu-suggestions.visible { display: block; }
        .client-suggestions { display: none; position: absolute; top: calc(100% + 4px); left: 0; right: 0;
            background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 210; overflow: hidden; }
        .client-suggestions.visible { display: block; }

        /* Item générique */
        .ac-item {
            padding: 11px 14px 11px 16px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            color: #222;
            cursor: pointer;
            border-bottom: 1px solid #F5F5F5;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        .ac-item:last-child { border-bottom: none; }
        .ac-item:active { background: #FFF5F5; }
        /* .ac-item-badge réservé pour usage futur */
        .ac-item-name {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        /* Items historique : légèrement plus gras */
        .ac-item.ac-user .ac-item-name { font-weight: 600; }
        /* Bouton × supprimer (historique utilisateur seulement) */
        .ac-item-del {
            color: #C7C7CC;
            font-size: 18px;
            padding: 0 4px;
            flex-shrink: 0;
            line-height: 1;
            cursor: pointer;
        }
        .ac-item-del:active { color: #FD636B; }

        /* Bouton ⚙ gestion de liste */
        .ac-manage-btn {
            background: transparent;
            border: none;
            color: #C7C7CC;
            font-size: 16px;
            padding: 0 4px;
            flex-shrink: 0;
            cursor: pointer;
            line-height: 1;
            -webkit-appearance: none;
        }
        .ac-manage-btn:active { color: #FD636B; }

        /* Modal gestion liste clients */
        .clients-modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            z-index: 600;
            align-items: flex-end;
        }
        .clients-modal-overlay.open { display: flex; }
        .clients-modal {
            background: white;
            width: 100%;
            border-radius: 20px 20px 0 0;
            padding: 20px 16px 44px;
            max-height: 65vh;
            overflow-y: auto;
        }
        .clients-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        .clients-modal-title { font-size: 16px; font-weight: 700; }
        .clients-modal-subtitle { font-size: 12px; color: #8E8E93; margin-bottom: 14px; }
        .clients-modal-close {
            background: #F0F0F0; border: none;
            width: 30px; height: 30px; border-radius: 15px;
            font-size: 16px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: #666;
        }
        .clients-modal-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 13px 0;
            border-bottom: 1px solid #F0F0F0;
            font-size: 15px;
        }
        .clients-modal-item:last-child { border-bottom: none; }
        .clients-modal-item-name { flex: 1; }
        .clients-modal-item-count { font-size: 12px; color: #8E8E93; margin-right: 12px; }
        .clients-modal-del {
            background: transparent; border: none;
            color: #C7C7CC; font-size: 20px;
            cursor: pointer; padding: 0 4px; line-height: 1;
        }
        .clients-modal-del:active { color: #FD636B; }
        .clients-modal-empty { color: #8E8E93; font-size: 14px; text-align: center; padding: 24px 0; }

        .copy-btn-small {
            padding: 12px 14px;
            background: #F0F0F0;
            border: none;
            border-radius: 8px;
            color: #FD636B;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .copy-btn-small span {
            color: #666;
            font-size: 10px;
            font-weight: 400;
        }

        .copy-btn-small:active { background: #E5E5E5; }

        .client-entry {
            padding: 12px 0;
            border-top: 1px solid #F5F5F5;
        }

        .client-entry .hours-display {
            margin-top: 8px;
            background: linear-gradient(135deg, #3AE8B0 0%, #19AFD0 100%);
        }

        /* CLIENT */
        .client-select-container {
            position: relative;
            margin-bottom: 12px;
        }

        .client-select-container select {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E5E5;
            border-radius: 10px;
            font-size: 15px;
            background: #F8F8F8;
        }
        .client-select-container select:focus { outline: none; border-color: #FD636B; background: white; }

        /* TEMPS */
        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .time-group label {
            font-size: 12px;
            color: #8E8E93;
            margin-bottom: 6px;
            display: block;
        }

        input[type="time"] {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #E5E5E5;
            border-radius: 10px;
            font-size: 16px;
            background: #F8F8F8;
            color: #000;
            font-weight: 500;
            text-align: center;
            caret-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
            pointer-events: auto;
        }


        input[type="time"]:read-only {
            background: #F8F8F8;
            color: #000;
            opacity: 1;
            -webkit-text-fill-color: #000;
        }

        input[type="time"]:focus {
            outline: none;
            border-color: #FD636B;
            background: white;
        }


        input[type="time"]::-webkit-calendar-picker-indicator {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%236967CE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>') center/contain no-repeat;
            cursor: pointer;
            width: 20px;
            height: 20px;
            position: absolute;
            right: 12px;
        }

        input[type="time"]::-webkit-datetime-edit-hour-field,
        input[type="time"]::-webkit-datetime-edit-minute-field {
            padding: 2px;
            background: transparent;
            color: #000;
        }

        input[type="time"]::-webkit-datetime-edit-text {
            padding: 0 2px;
            color: #8E8E93;
        }


        /* INPUTS */
        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E5E5;
            border-radius: 10px;
            font-size: 15px;
            margin-bottom: 12px;
            background: #F8F8F8;
            font-family: 'Poppins', sans-serif;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #FD636B;
            background: white;
        }

        /* HEURES */
        .hours-display {
            background: linear-gradient(135deg, #FFB900 0%, #e0a500 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            margin-top: 8px;
            box-shadow: 0 2px 6px rgba(255, 185, 0, 0.25);
        }

        /* KM */
        .km-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        /* REPAS */
        .meal-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: #F8F8F8;
            border-radius: 10px;
            margin-bottom: 0;
            min-height: 44px;
        }

        .meal-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #FD636B;
            flex-shrink: 0;
            margin: 0;
        }

        .meal-checkbox label {
            flex: 1;
            font-size: 14px;
            cursor: pointer;
            line-height: 1;
        }

        /* FRAIS */
        .expenses-section {
            background: white;
            padding: 8px 16px;
            border-top: 1px solid #F0F0F0;
        }

        .expenses-header {
            font-size: 14px;
            font-weight: 600;
            color: #FD636B;
            margin-bottom: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 36px;
            padding: 4px 0;
        }

        .add-expense-btn,
        .add-km-btn {
            color: #FD636B;
            font-size: 24px;
            font-weight: 300;
            line-height: 1;
            cursor: pointer;
            flex-shrink: 0;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }
        .add-expense-btn:active,
        .add-km-btn:active { opacity: 0.4; }

        .expense-item { display: grid; grid-template-columns: 2fr 1fr auto; gap: 8px; margin-top: 8px; margin-bottom: 4px; align-items: center; }
        .expense-item.hidden { display: none; }

        .expense-item input {
            margin-bottom: 0;
            padding: 10px 12px;
            height: 40px;
        }

        .expense-item input[type="number"] {
            text-align: right;
        }

        .remove-expense-btn {
            background: #FD636B;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 14px;
            font-size: 18px;
            font-weight: 300;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-appearance: none;
            appearance: none;
            padding: 0;
            flex-shrink: 0;
        }

        /* TOTAUX */
        .weekly-total {
            background: white;
            margin: 12px;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .weekly-total h3 {
            font-size: 14px;
            color: #8E8E93;
            margin-bottom: 8px;
        }

        .weekly-total .total {
            font-size: 32px;
            font-weight: 700;
            color: #FD636B;
        }

        /* FOOTER */
        .summary-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.99);
            backdrop-filter: blur(24px);
            border-top: 2px solid #F0F0F0;
            padding: 10px 12px 14px;
            z-index: 100;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .summary-footer.hidden {
            transform: translateY(100%);
        }

        /* SECTIONS D'INFORMATIONS */
        .info-section {
            background: white;
            margin: 12px;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .info-section label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #FD636B;
            margin-bottom: 10px;
        }

        .info-section textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #E5E5E5;
            border-radius: 10px;
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            background: #F8F8F8;
            resize: vertical;
        }

        .info-section textarea:focus {
            outline: none;
            border-color: #FD636B;
            background: white;
        }

        .info-section input[type="email"],
        .info-section input[type="text"],
        .info-section input[type="tel"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E5E5;
            border-radius: 10px;
            font-size: 15px;
            background: #F8F8F8;
            height: 44px;
            box-sizing: border-box;
        }

        .info-section input:focus {
            outline: none;
            border-color: #FD636B;
            background: white;
        }

        .personal-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .personal-info-grid input:nth-child(3),
        .personal-info-grid input:nth-child(8) {
            grid-column: 1 / -1;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }

        .summary-item {
            text-align: center;
            padding: 8px 4px;
            background: white;
            border-radius: 8px;
            border: 1px solid #E5E5E5;
        }

        .summary-item .label {
            font-size: 9px;
            color: #8E8E93;
            font-weight: 500;
            margin-bottom: 2px;
            text-transform: uppercase;
        }

        .summary-item .value {
            font-size: 15px;
            font-weight: 600;
            color: #1a1a2e;
        }

        /* ── BARRE D'ACTIONS — palette Asana ── */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            gap: 6px;
        }

        .action-btn {
            padding: 11px 2px;
            border: none;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            color: white;
            letter-spacing: 0px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: opacity 0.15s ease, transform 0.1s ease;
        }

        /* Excel — vert clair Asana */
        .btn-export {
            background: #36D5A8;
            box-shadow: 0 2px 8px rgba(54, 213, 168, 0.35);
        }

        /* PDF — bleu clair Asana (cyan) */
        .btn-pdf {
            background: #19AFD0;
            box-shadow: 0 2px 8px rgba(25, 175, 208, 0.35);
        }

        /* Sauver — violet Asana */
        .btn-backup-export {
            background: #6967CE;
            box-shadow: 0 2px 8px rgba(105, 103, 206, 0.35);
        }

        /* Rest. — jaune Asana */
        .btn-backup-import {
            background: #FFB900;
            box-shadow: 0 2px 8px rgba(255, 185, 0, 0.35);
        }

        /* Effacer — rouge Asana */
        .btn-clear {
            background: #FD636B;
            box-shadow: 0 2px 8px rgba(253, 99, 107, 0.35);
        }

        .action-btn:active {
            transform: scale(0.96);
            opacity: 0.85;
        }

        /* BOUTONS CLIENT */
        .copy-morning-btn {
            padding: 8px 12px;
            background: #F0F0F0;
            border: none;
            border-radius: 8px;
            color: #FD636B;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }
        .copy-morning-btn:active { background: #E5E5E5; }

        .add-client-btn {
            width: 32px;
            height: 32px;
            border-radius: 16px;
            background: #FD636B;
            color: white;
            border: none;
            font-size: 20px;
            font-weight: 300;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-appearance: none;
            appearance: none;
            padding: 0;
        }
        .add-client-btn:active { opacity: 0.7; }

        /* Bouton ajouter client discret en bas */
        .add-client-line-btn {
            width: 100%;
            padding: 10px;
            margin-top: 12px;
            margin-bottom: 4px;
            background: transparent;
            border: 1px dashed #E5E5E5;
            border-radius: 8px;
            color: #8E8E93;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            line-height: 1;
            -webkit-appearance: none;
            appearance: none;
        }

        .add-client-line-btn span {
            color: #FD636B;
            font-size: 18px;
            font-weight: 400;
            line-height: 1;
            display: flex;
            align-items: center;
        }

        .add-client-line-btn:active {
            background: #F8F8F8;
            border-color: #FD636B;
        }

        /* CALENDRIER */
        .calendar-section {
            background: white;
            margin: 12px;
            padding: 14px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .calendar-header {
            font-size: 15px;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            color: #1a1a2e;
            text-align: center;
            flex: 1;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
        }
        .calendar-header:active { opacity: 0.6; }

        .cal-picker-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            z-index: 300;
            align-items: flex-end;
        }
        .cal-picker-overlay.visible { display: flex; }
        .cal-picker-sheet {
            background: white;
            width: 100%;
            border-radius: 18px 18px 0 0;
            padding: 20px 16px 32px;
        }
        .cal-picker-title {
            font-size: 13px;
            font-weight: 700;
            color: #8E8E93;
            text-align: center;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .cal-picker-row {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .cal-picker-select {
            flex: 1;
            padding: 12px;
            border: 1.5px solid #E5E5E5;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            color: #1a1a2e;
            background: #F8F8F8;
            font-family: 'Poppins', sans-serif;
            -webkit-appearance: none;
            text-align: center;
        }
        .cal-picker-select:focus { outline: none; border-color: #6967CE; background: white; }
        .cal-picker-confirm {
            width: 100%;
            padding: 14px;
            background: #6967CE;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 4px;
            font-family: 'Poppins', sans-serif;
        }
        .cal-picker-confirm:active { opacity: 0.85; }
        .cal-picker-cancel {
            width: 100%;
            padding: 12px;
            background: none;
            color: #8E8E93;
            border: none;
            font-size: 14px;
            cursor: pointer;
            margin-top: 4px;
            font-family: 'Poppins', sans-serif;
        }

        .cal-nav-btn {
            background: none;
            border: none;
            font-size: 22px;
            color: #FD636B;
            cursor: pointer;
            padding: 0 10px;
            line-height: 1;
            font-weight: 300;
        }
        .cal-nav-btn:active { opacity: 0.5; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .calendar-day-label {
            text-align: center;
            font-size: 10px;
            color: #8E8E93;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            padding: 4px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #000;
            position: relative;
            cursor: pointer;
        }

        .calendar-day.other-month { color: #C7C7CC; }
        .calendar-day.today::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
        }

        .calendar-day.has-hours::after {
            content: '';
            position: absolute;
            bottom: 2px;
            width: 4px;
            height: 4px;
            background: #6967CE;
            border-radius: 50%;
        }

        .calendar-day.today.has-hours::after {
            box-shadow: 0 0 0 1px #000;
        }

        .calendar-day:active { opacity: 0.6; }

        /* Dimanches grisés et non interactifs */
        .calendar-sunday {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 400;
            color: #C7C7CC;
            position: relative;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Scroll fluide global */
        html { scroll-behavior: smooth; }

        /* TIME PICKER PERSONNALISÉ */
        .time-picker-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-picker-modal {
            background: #F0F0F0;
            border-radius: 16px;
            width: 90%;
            max-width: 320px;
            overflow: hidden;
        }

        .time-picker-header {
            background: #E0E0E0;
            padding: 20px;
            text-align: center;
        }

        .time-picker-header span {
            font-size: 42px;
            font-weight: 300;
            color: #222222;
            letter-spacing: 3px;
        }

        .time-picker-mode {
            display: flex;
            background: #E0E0E0;
            padding: 0 12px 12px 12px;
            gap: 8px;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: 1px solid #C8C8C8;
            color: #8E8E93;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .mode-btn.active {
            background: #FD636B;
            border-color: #FD636B;
            color: white;
        }

        .time-picker-body {
            padding: 20px 12px;
            background: #F0F0F0;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .time-number {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #E0E0E0;
            border: 1px solid #C8C8C8;
            border-radius: 8px;
            color: #333333;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
        }

        .time-number:active {
            background: #D0D0D0;
        }

        .time-number.selected {
            background: #FD636B;
            border-color: #FD636B;
            color: white;
        }

        .time-picker-actions {
            display: flex;
            border-top: 1px solid #C8C8C8;
        }

        .time-picker-actions button {
            flex: 1;
            padding: 16px;
            border: none;
            background: transparent;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .time-btn-cancel {
            color: #8E8E93;
            border-right: 1px solid #C8C8C8;
        }

        .time-btn-ok {
            color: #FD636B;
        }

        .time-btn-cancel:active {
            background: rgba(255, 255, 255, 0.05);
        }

        .time-btn-ok:active {
            background: rgba(216, 69, 69, 0.1);
        }
    </style>
</head>
<body>
    <script>
        // Anti-FOUC : révèle le body immédiatement après parsing du HTML
        document.addEventListener('DOMContentLoaded', () => {
            document.body.classList.add('ready');
        });
    </script>
    <div class="header">
        <div class="logo-container">
            <input type="text" id="companyName" placeholder="Entreprise" style="font-family:'Poppins', sans-serif;font-size:36px;font-weight:800;color:#000000;letter-spacing:1px;text-align:center;background:transparent;border:none;padding:4px 0;margin-bottom:0;width:100%;outline:none;" oninput="saveCompanyName()" />
            <span class="company-cursor" id="companyCursor" aria-hidden="true"></span>
        </div>
        <input type="text" id="employeeName" placeholder="Nom complet" />
    </div>

    <div class="week-nav">
        <button class="week-prev">← Préc.</button>
        <div class="week-date" id="weekDisplay"></div>
        <button class="week-next">Suiv. →</button>
    </div>

    <div class="day-shortcuts" id="dayShortcuts"></div>

    <div id="daysContainer"></div>

    <div class="weekly-total">
        <h3>TOTAL HEURES SEMAINE</h3>
        <div class="total" id="weeklyTotal">0h00</div>
    </div>

    <div class="calendar-section">
        <div class="calendar-nav">
            <button class="cal-nav-btn cal-prev-year" aria-label="Année précédente">«</button>
            <button class="cal-nav-btn cal-prev-month" aria-label="Mois précédent">‹</button>
            <div class="calendar-header" id="calendarHeader"></div>
            <button class="cal-nav-btn cal-next-month" aria-label="Mois suivant">›</button>
            <button class="cal-nav-btn cal-next-year" aria-label="Année suivante">»</button>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <div class="cal-picker-overlay" id="calPickerOverlay">
        <div class="cal-picker-sheet">
            <div class="cal-picker-title">Aller à</div>
            <div class="cal-picker-row">
                <select class="cal-picker-select" id="calPickerMonth">
                    <option value="0">Janvier</option>
                    <option value="1">Février</option>
                    <option value="2">Mars</option>
                    <option value="3">Avril</option>
                    <option value="4">Mai</option>
                    <option value="5">Juin</option>
                    <option value="6">Juillet</option>
                    <option value="7">Août</option>
                    <option value="8">Septembre</option>
                    <option value="9">Octobre</option>
                    <option value="10">Novembre</option>
                    <option value="11">Décembre</option>
                </select>
                <select class="cal-picker-select" id="calPickerYear"></select>
            </div>
            <button class="cal-picker-confirm" id="calPickerConfirm">Confirmer</button>
            <button class="cal-picker-cancel" id="calPickerCancel">Annuler</button>
        </div>
    </div>

    <div class="summary-footer">
        <div class="summary-grid">
            <div class="summary-item">
                <div class="label">Heures</div>
                <div class="value" id="weekHours">0h</div>
            </div>
            <div class="summary-item">
                <div class="label">KM</div>
                <div class="value" id="weekKm">0</div>
            </div>
            <div class="summary-item">
                <div class="label">Repas</div>
                <div class="value" id="weekMeals">0</div>
            </div>
            <div class="summary-item">
                <div class="label">Frais</div>
                <div class="value" id="weekExpenses">0</div>
            </div>
        </div>
        <div class="action-buttons">
            <button class="action-btn btn-export">Excel</button>
            <button class="action-btn btn-pdf">PDF</button>
            <button class="action-btn btn-backup-export">Sauver</button>
            <button class="action-btn btn-backup-import">Rest.</button>
            <button class="action-btn btn-clear">Effacer</button>
        </div>
        <input type="file" id="importFile" accept=".json" style="display:none;">
    </div>

    <!-- Note / Informations complémentaires -->
    <div class="info-section">
        <label>Informations complémentaires</label>
        <textarea id="notes" placeholder="Ajoutez vos notes, suggestions ou informations complémentaires ici..." onchange="debouncedSave();"></textarea>
    </div>

    <!-- Informations personnelles -->
    <div class="info-section">
        <label>Informations personnelles</label>
        <div class="personal-info-grid">
            <input type="text" id="firstName" placeholder="Prénom" onchange="debouncedSave();" />
            <input type="text" id="lastName" placeholder="Nom" onchange="debouncedSave();" />
            <input type="text" id="address" placeholder="Adresse" onchange="debouncedSave();" />
            <input type="text" id="city" placeholder="Ville" onchange="debouncedSave();" />
            <input type="text" id="postalCode" placeholder="Code postal" onchange="debouncedSave();" />
            <input type="text" id="country" placeholder="Pays" onchange="debouncedSave();" />
            <input type="tel" id="phone" placeholder="Téléphone" onchange="debouncedSave();" />
            <input type="email" id="personalEmail" placeholder="Email" onchange="debouncedSave();" />
        </div>
    </div>

    <!-- Time Picker Personnalisé -->
    <div id="customTimePicker" class="time-picker-overlay" style="display: none;" role="dialog" aria-modal="true" aria-label="Sélecteur d'heure">
        <div class="time-picker-modal">
            <div class="time-picker-header">
                <span id="pickerDisplay">00:00</span>
            </div>
            <div class="time-picker-mode">
                <button class="mode-btn active" id="modeHour" data-mode="hour">Heures</button>
                <button class="mode-btn" id="modeMinute" data-mode="minute">Minutes</button>
            </div>
            <div class="time-picker-body">
                <div class="time-grid" id="hourGrid"></div>
                <div class="time-grid" id="minuteGrid" style="display: none;"></div>
            </div>
            <div class="time-picker-actions">
                <button class="time-btn-cancel">Annuler</button>
                <button class="time-btn-ok">OK</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- jsPDF : export PDF avec texte sélectionnable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    

    <script>
        const daysOfWeek = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
        const monthNames = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
        const dayLabels = ['D', 'L', 'M', 'M', 'J', 'V', 'S'];

        let currentWeekStart = new Date();
        currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay() + 1); // Lundi
        let calendarViewMonth = new Date(currentWeekStart); // mois affiché dans le calendrier

        let currentTimeInput = null;
        let selectedHour = 0;
        let selectedMinute = 0;
        let currentMode = 'hour';

        function openCustomTimePicker(input) {
            currentTimeInput = input;
            const currentValue = input.value;

            if (currentValue && currentValue !== '--:--') {
                const [h, m] = currentValue.split(':');
                selectedHour = parseInt(h);
                selectedMinute = parseInt(m);
            } else {
                const now = new Date();
                selectedHour = now.getHours();
                selectedMinute = Math.round(now.getMinutes() / 5) * 5;
                if (selectedMinute >= 60) selectedMinute = 55;
            }

            initPicker();
            updateTimeDisplay();
            document.getElementById('customTimePicker').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function initPicker() {
            const hourGrid = document.getElementById('hourGrid');
            const minuteGrid = document.getElementById('minuteGrid');

            hourGrid.innerHTML = '';
            minuteGrid.innerHTML = '';

            // Grille heures (0-23)
            for (let i = 0; i < 24; i++) {
                const btn = document.createElement('div');
                btn.className = 'time-number' + (i === selectedHour ? ' selected' : '');
                btn.textContent = String(i).padStart(2, '0');
                btn.onclick = () => selectHour(i);
                hourGrid.appendChild(btn);
            }

            // Grille minutes (0, 5, 10... 55)
            for (let i = 0; i < 60; i += 5) {
                const btn = document.createElement('div');
                btn.className = 'time-number' + (i === selectedMinute ? ' selected' : '');
                btn.textContent = String(i).padStart(2, '0');
                btn.onclick = () => selectMinute(i);
                minuteGrid.appendChild(btn);
            }

            // Afficher heures par défaut
            switchMode('hour');
        }

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('modeHour').classList.toggle('active', mode === 'hour');
            document.getElementById('modeMinute').classList.toggle('active', mode === 'minute');
            document.getElementById('hourGrid').style.display = mode === 'hour' ? 'grid' : 'none';
            document.getElementById('minuteGrid').style.display = mode === 'minute' ? 'grid' : 'none';
        }

        function selectHour(h) {
            selectedHour = h;
            updateTimeDisplay();

            // Mettre à jour visuellement
            document.querySelectorAll('#hourGrid .time-number').forEach((btn, i) => {
                btn.classList.toggle('selected', i === h);
            });

            // Passer aux minutes automatiquement
            setTimeout(() => switchMode('minute'), 200);
        }

        function selectMinute(m) {
            selectedMinute = m;
            updateTimeDisplay();

            // Mettre à jour visuellement
            document.querySelectorAll('#minuteGrid .time-number').forEach((btn, i) => {
                btn.classList.toggle('selected', i === (m / 5));
            });
        }

        function updateTimeDisplay() {
            document.getElementById('pickerDisplay').textContent =
                `${String(selectedHour).padStart(2, '0')}:${String(selectedMinute).padStart(2, '0')}`;
        }

        function closeTimePicker() {
            document.getElementById('customTimePicker').style.display = 'none';
            document.body.style.overflow = 'auto';
            currentTimeInput = null;
        }

        function confirmTime() {
            if (currentTimeInput) {
                const timeValue = `${String(selectedHour).padStart(2, '0')}:${String(selectedMinute).padStart(2, '0')}`;
                currentTimeInput.value = timeValue;

                const match = currentTimeInput.id.match(/^(start|end)_(\d+)_/);
                if (match) {
                    const dayIndex = parseInt(match[2]);
                    calculateDayHours(dayIndex);
                    saveAllData();
                }
            }
            closeTimePicker();
        }

        // Copie automatique matin → après-midi
        function autoFillAfternoon(dayIndex, field) {
            const morningValue = document.getElementById(`${field}_${dayIndex}_am`)?.value || '';
            const afternoonField = document.getElementById(`${field}_${dayIndex}_pm`);

            if (afternoonField && morningValue) {
                afternoonField.value = morningValue;
            }
        }


        // ============================================================
        // Debounce : évite de sauvegarder à chaque frappe
        // ============================================================
        let _saveDebounceTimer = null;
        function debouncedSave() {
            clearTimeout(_saveDebounceTimer);
            _saveDebounceTimer = setTimeout(saveAllData, 600);
        }

        // ============================================================
        // addClientEntry : ajoute un client supplémentaire, persistant
        // Les clients supplémentaires sont maintenant correctement
        // sauvegardés dans localStorage via saveAllData()
        // ============================================================
        function addClientEntry(dayIndex, period, savedData = null) {
            const periodSection = savedData
                ? document.querySelector(`#daysContainer .day-card:nth-child(${dayIndex + 1}) .period-section:${period === 'am' ? 'first-of-type' : 'last-of-type'}`)
                : event.target.closest('.period-section');
            if (!periodSection) return;

            const existingEntries = periodSection.querySelectorAll('.client-entry').length;
            const clientNumber = existingEntries + 2;
            const addButton = savedData
                ? periodSection.querySelector('.add-client-line-btn')
                : event.target.closest('.add-client-line-btn');

            const newEntry = document.createElement('div');
            newEntry.className = 'client-entry';

            // ID unique via timestamp + random (sans collision possible)
            const entryId = savedData?.id || (Date.now() + '_' + Math.floor(Math.random() * 9999));

            newEntry.dataset.entryId = entryId;
            newEntry.innerHTML = `
                <div class="client-row">
                    <div class="ac-wrapper">
                        <input type="text" id="client_${dayIndex}_${period}_${entryId}"
                               placeholder="Client ${clientNumber}"
                               aria-label="Nom du client supplémentaire ${clientNumber}"
                               autocomplete="off"
                               value="${savedData?.client || ''}"
                               oninput="showAcSuggestions(this,'client')"
                               onblur="hideAcSuggestions(this)"
                               onchange="recordAc('client',this.value); debouncedSave();" />
                        <div class="ac-suggestions"></div>
                    </div>
                    <button class="add-client-btn"
                            style="background:#FD636B;"
                            aria-label="Supprimer ce client"
                            data-action="remove-client">×</button>
                </div>
                <div class="time-inputs">
                    <div class="time-group">
                        <label>Début</label>
                        <input type="text" id="start_${dayIndex}_${period}_${entryId}"
                               readonly placeholder="--:--"
                               aria-label="Heure de début"
                               value="${savedData?.start || ''}"
                               data-timepicker="true" />
                    </div>
                    <div class="time-group">
                        <label>Fin</label>
                        <input type="text" id="end_${dayIndex}_${period}_${entryId}"
                               readonly placeholder="--:--"
                               aria-label="Heure de fin"
                               value="${savedData?.end || ''}"
                               data-timepicker="true" />
                    </div>
                </div>
                <div class="ac-wrapper">
                    <input type="text" id="desc_${dayIndex}_${period}_${entryId}"
                           placeholder="Description"
                           aria-label="Description"
                           autocomplete="off"
                           value="${savedData?.desc || ''}"
                           oninput="showAcSuggestions(this,'desc')"
                           onblur="hideAcSuggestions(this)"
                           onchange="recordAc('desc',this.value); debouncedSave();" />
                    <div class="ac-suggestions"></div>
                </div>
                <div class="ac-wrapper">
                    <input type="text" id="location_${dayIndex}_${period}_${entryId}"
                           placeholder="Lieu"
                           aria-label="Lieu"
                           autocomplete="off"
                           value="${savedData?.location || ''}"
                           oninput="showAcSuggestions(this,'lieu')"
                           onblur="hideAcSuggestions(this)"
                           onchange="recordAc('lieu',this.value); debouncedSave();" />
                    <div class="ac-suggestions"></div>
                </div>
            `;

            if (addButton) {
                addButton.parentNode.insertBefore(newEntry, addButton);
            } else {
                periodSection.appendChild(newEntry);
            }
        }

        function getWeekKey() {
            return `week_${currentWeekStart.toISOString().split('T')[0]}`;
        }

        function formatDate(date) {
            const d = new Date(date);
            const yy = String(d.getFullYear()).slice(-2);
            return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${yy}`;
        }

        function formatDateFull(date) {
            const d = new Date(date);
            const year = String(d.getFullYear()).slice(-2);
            return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${year}`;
        }

        function changeWeek(direction) {
            saveAllData();
            currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
            loadWeekData();
            renderWeek();
        }

        // ============================================================
        // Raccourcis jours avec feedback visuel
        // ============================================================
        function renderDayShortcuts() {
            const container = document.getElementById('dayShortcuts');
            container.innerHTML = '';
            const today = new Date();
            const shortLabels = ['Lu', 'Ma', 'Me', 'Je', 'Ve', 'Sa'];

            for (let i = 0; i < 6; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                const isToday = date.toDateString() === today.toDateString();

                const btn = document.createElement('button');
                btn.className = 'day-shortcut' + (isToday ? ' sc-today' : '');
                btn.setAttribute('aria-label', `Aller au ${shortLabels[i]} ${date.getDate()}`);
                btn.innerHTML = `
                    <span class="sc-label">${shortLabels[i]}</span>
                    <span class="sc-num">${date.getDate()}</span>
                `;
                btn.addEventListener('click', () => {
                    const cards = document.querySelectorAll('.day-card');
                    if (cards[i]) {
                        // Scroll fluide (scroll-behavior:smooth sur html)
                        cards[i].scrollIntoView({ behavior: 'smooth', block: 'start' });

                        cards[i].style.transition = 'box-shadow 0.15s ease';
                        cards[i].style.boxShadow = '0 0 0 3px #FD636B';
                        setTimeout(() => {
                            cards[i].style.boxShadow = '';
                        }, 900);
                    }
                });
                container.appendChild(btn);
            }
        }

        function renderWeek() {
            const container = document.getElementById('daysContainer');
            container.innerHTML = '';

            const endDate = new Date(currentWeekStart);
            endDate.setDate(endDate.getDate() + 5);

            document.getElementById('weekDisplay').textContent =
                monthNames[currentWeekStart.getMonth()];

            renderDayShortcuts();

            for (let i = 0; i < 6; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);

                const card = document.createElement('div');
                card.className = 'day-card';
                card.innerHTML = `
                    <div class="day-title">
                        <span class="day-name">${daysOfWeek[date.getDay()]}</span>
                        <span class="day-date">${formatDate(date)}</span>
                    </div>

                    <!-- MATIN -->
                    <div class="period-section">
                        <div class="period-header">Matin</div>
                        <div class="client-row">
                            <div class="ac-wrapper">
                                <input type="text" id="client_${i}_am"
                                       placeholder="Nom du client"
                                       aria-label="Client matin"
                                       autocomplete="off"
                                       oninput="showAcSuggestions(this,'client')"
                                       onblur="hideAcSuggestions(this)"
                                       onchange="recordAc('client',this.value); debouncedSave(); autoFillAfternoon(${i}, 'client');" />
                                <div class="ac-suggestions"></div>
                            </div>
                            <button class="ac-manage-btn" data-modal="client" aria-label="Gérer la liste des clients" title="Gérer les clients">⚙</button>
                        </div>
                        <div class="time-inputs">
                            <div class="time-group">
                                <label>Début</label>
                                <input type="text" id="start_${i}_am" readonly placeholder="--:--"
                                       aria-label="Heure de début matin"
                                       data-timepicker="true" />
                            </div>
                            <div class="time-group">
                                <label>Fin</label>
                                <input type="text" id="end_${i}_am" readonly placeholder="--:--"
                                       aria-label="Heure de fin matin"
                                       data-timepicker="true" />
                            </div>
                        </div>
                        <div class="ac-wrapper">
                            <input type="text" id="desc_${i}_am" placeholder="Description"
                                   aria-label="Description matin"
                                   autocomplete="off"
                                   oninput="showAcSuggestions(this,'desc')"
                                   onblur="hideAcSuggestions(this)"
                                   onchange="recordAc('desc',this.value); debouncedSave(); autoFillAfternoon(${i}, 'desc');" />
                            <div class="ac-suggestions"></div>
                        </div>
                        <div style="display:flex;align-items:center;gap:6px;">
                            <div class="ac-wrapper">
                                <input type="text" id="location_${i}_am" placeholder="Lieu"
                                       autocomplete="off"
                                       aria-label="Lieu matin"
                                       oninput="showAcSuggestions(this,'lieu')"
                                       onblur="hideAcSuggestions(this)"
                                       onchange="recordAc('lieu',this.value); debouncedSave(); autoFillAfternoon(${i}, 'location');" />
                                <div class="ac-suggestions"></div>
                            </div>
                        </div>
                        <button class="add-client-line-btn"
                                aria-label="Ajouter un client supplémentaire le matin"
                                data-day="${i}" data-period="am">
                            <span>+</span> Ajouter un client
                        </button>
                    </div>

                    <!-- APRÈS-MIDI -->
                    <div class="period-section">
                        <div class="day-header">
                            <span class="period-header">Après-midi</span>
                            <span class="day-date">${formatDate(date)}</span>
                        </div>
                        <div class="client-row">
                            <div class="ac-wrapper">
                                <input type="text" id="client_${i}_pm"
                                       placeholder="Nom du client"
                                       aria-label="Client après-midi"
                                       autocomplete="off"
                                       oninput="showAcSuggestions(this,'client')"
                                       onblur="hideAcSuggestions(this)"
                                       onchange="recordAc('client',this.value); debouncedSave();" />
                                <div class="ac-suggestions"></div>
                            </div>
                        </div>
                        <div class="time-inputs">
                            <div class="time-group">
                                <label>Début</label>
                                <input type="text" id="start_${i}_pm" readonly placeholder="--:--"
                                       aria-label="Heure de début après-midi"
                                       data-timepicker="true" />
                            </div>
                            <div class="time-group">
                                <label>Fin</label>
                                <input type="text" id="end_${i}_pm" readonly placeholder="--:--"
                                       aria-label="Heure de fin après-midi"
                                       data-timepicker="true" />
                            </div>
                        </div>
                        <div class="desc-row">
                            <div class="ac-wrapper">
                                <input type="text" id="desc_${i}_pm" placeholder="Description"
                                       aria-label="Description après-midi"
                                       autocomplete="off"
                                       oninput="showAcSuggestions(this,'desc')"
                                       onblur="hideAcSuggestions(this)"
                                       onchange="recordAc('desc',this.value); debouncedSave();" />
                                <div class="ac-suggestions"></div>
                            </div>
                        </div>
                        <div class="location-row">
                            <div class="ac-wrapper">
                                <input type="text" id="location_${i}_pm" placeholder="Lieu"
                                       autocomplete="off"
                                       aria-label="Lieu après-midi"
                                       oninput="showAcSuggestions(this,'lieu')"
                                       onblur="hideAcSuggestions(this)"
                                       onchange="recordAc('lieu',this.value); debouncedSave();" />
                                <div class="ac-suggestions"></div>
                            </div>
                        </div>
                        <button class="add-client-line-btn"
                                aria-label="Ajouter un client supplémentaire l'après-midi"
                                data-day="${i}" data-period="pm">
                            <span>+</span> Ajouter un client
                        </button>
                        <div class="hours-display" id="hours_day_${i}">0h00</div>
                    </div>

                    <!-- VÉHICULE PERSONNEL -->
                    <div class="expenses-section" style="border-top:none;padding-top:0;">
                        <div class="expenses-header">
                            Véhicule Personnel
                            <span class="add-km-btn"
                                  role="button" tabindex="0"
                                  aria-label="Ajouter un trajet"
                                  data-day="${i}">+</span>
                        </div>
                        <div id="km_${i}"></div>
                    </div>

                    <!-- FRAIS -->
                    <div class="expenses-section">
                        <div class="expenses-header">
                            Frais (avec quittance)
                            <span class="add-expense-btn"
                                  role="button" tabindex="0"
                                  aria-label="Ajouter un frais"
                                  data-day="${i}">+</span>
                        </div>
                        <div id="expenses_${i}"></div>
                        <div class="meal-checkbox">
                            <input type="checkbox" id="meal_${i}"
                                   aria-label="Repas remboursé"
                                   onchange="saveAllData(); calculateTotals();" />
                            <label for="meal_${i}">Repas remboursé</label>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            }

            loadWeekData();
            calculateTotals();
            renderCalendar();
        }

        function calculateDayHours(dayIndex) {
            let dayTotalMinutes = 0;

            ['am', 'pm'].forEach(period => {
                const start = document.getElementById(`start_${dayIndex}_${period}`)?.value;
                const end   = document.getElementById(`end_${dayIndex}_${period}`)?.value;

                if (start && end && start !== '--:--' && end !== '--:--') {
                    const [startH, startM] = start.split(':').map(Number);
                    const [endH, endM]     = end.split(':').map(Number);
                    let minutes = (endH * 60 + endM) - (startH * 60 + startM);
                    if (minutes < 0) minutes += 24 * 60;
                    dayTotalMinutes += minutes;
                }

                // Clients supplémentaires
                document.querySelectorAll(`[id^="start_${dayIndex}_${period}_"]`).forEach(startInput => {
                    const id = startInput.id.replace(`start_${dayIndex}_${period}_`, '');
                    const endInput = document.getElementById(`end_${dayIndex}_${period}_${id}`);
                    if (startInput.value && endInput?.value &&
                        startInput.value !== '--:--' && endInput.value !== '--:--') {
                        const [startH, startM] = startInput.value.split(':').map(Number);
                        const [endH, endM]     = endInput.value.split(':').map(Number);
                        let minutes = (endH * 60 + endM) - (startH * 60 + startM);
                        if (minutes < 0) minutes += 24 * 60;
                        dayTotalMinutes += minutes;
                    }
                });
            });

            const dayHours = Math.floor(dayTotalMinutes / 60);
            const dayMins  = dayTotalMinutes % 60;
            const dayDisplay = document.getElementById(`hours_day_${dayIndex}`);
            if (dayDisplay) dayDisplay.textContent = `${dayHours}h${String(dayMins).padStart(2, '0')}`;

            calculateTotals();
        }

        function calculateTotals() {
            let totalMinutes = 0, totalKm = 0, totalMeals = 0, totalExpenses = 0;

            for (let i = 0; i < 6; i++) {
                document.querySelectorAll(`[id^="start_${i}_"]`).forEach(startInput => {
                    const endInput = document.getElementById(startInput.id.replace('start_', 'end_'));
                    if (startInput.value && endInput?.value &&
                        startInput.value !== '--:--' && endInput.value !== '--:--') {
                        const [startH, startM] = startInput.value.split(':').map(Number);
                        const [endH, endM]     = endInput.value.split(':').map(Number);
                        let minutes = (endH * 60 + endM) - (startH * 60 + startM);
                        if (minutes < 0) minutes += 24 * 60;
                        totalMinutes += minutes;
                    }
                });

                const kmDiv = document.getElementById(`km_${i}`);
                if (kmDiv) kmDiv.querySelectorAll('input[type="number"]').forEach(inp => {
                    totalKm += parseFloat(inp.value) || 0;
                });

                if (document.getElementById(`meal_${i}`)?.checked) totalMeals++;

                const expDiv = document.getElementById(`expenses_${i}`);
                if (expDiv) expDiv.querySelectorAll('input[type="number"]').forEach(inp => {
                    totalExpenses += parseFloat(inp.value) || 0;
                });
            }

            const hours = Math.floor(totalMinutes / 60);
            const mins  = totalMinutes % 60;
            document.getElementById('weeklyTotal').textContent = `${hours}h${String(mins).padStart(2, '0')}`;
            document.getElementById('weekHours').textContent   = `${hours}h${String(mins).padStart(2, '0')}`;
            document.getElementById('weekKm').textContent      = Math.round(totalKm);
            document.getElementById('weekMeals').textContent   = totalMeals;
            document.getElementById('weekExpenses').textContent = totalExpenses.toFixed(2);
        }

        // ============================================================
        // IDs uniques sans compteur global
        // ============================================================
        function addExpense(dayIndex) {
            const container = document.getElementById(`expenses_${dayIndex}`);
            // ID unique : timestamp + aléatoire → pas de collision
            const expenseId = Date.now() + '_' + Math.floor(Math.random() * 9999);

            const expenseDiv = document.createElement('div');
            expenseDiv.className = 'expense-item';
            expenseDiv.innerHTML = `
                <input type="text" placeholder="Description"
                       aria-label="Description du frais"
                       onchange="debouncedSave();" />
                <input type="number" placeholder="0.00" step="0.05"
                       aria-label="Montant du frais"
                       onchange="debouncedSave(); calculateTotals();" />
                <button class="remove-expense-btn"
                        aria-label="Supprimer ce frais"
                        data-action="remove-item">×</button>
            `;
            container.appendChild(expenseDiv);
        }

        function addKm(dayIndex) {
            const container = document.getElementById(`km_${dayIndex}`);
            const kmId = Date.now() + '_' + Math.floor(Math.random() * 9999);

            const kmDiv = document.createElement('div');
            kmDiv.className = 'expense-item';
            kmDiv.innerHTML = `
                <input type="text" placeholder="Description du trajet"
                       aria-label="Description du trajet"
                       onchange="debouncedSave();" />
                <input type="number" placeholder="0" step="1"
                       aria-label="Nombre de kilomètres"
                       onchange="debouncedSave(); calculateTotals();" />
                <button class="remove-expense-btn"
                        aria-label="Supprimer ce trajet"
                        data-action="remove-item">×</button>
            `;
            container.appendChild(kmDiv);
        }

        // ============================================================
        // saveAllData : inclut les clients supplémentaires
        // ============================================================
        // ============================================================
        // MesHeuresDB — Couche IndexedDB silencieuse
        // Backup automatique à chaque saveAllData()
        // Restauration automatique si localStorage vide
        // ============================================================
        const MesHeuresDB = (() => {
            const DB_NAME    = 'mesheures_idb';
            const DB_VERSION = 1;
            const STORE      = 'snapshots';
            const MAX_SNAPS  = 3; // garder les 3 dernières versions
            let   _db        = null;

            // ── Ouvrir / créer la base ────────────────────────────
            function open() {
                return new Promise((resolve, reject) => {
                    if (_db) { resolve(_db); return; }
                    if (!window.indexedDB) { reject(new Error('IndexedDB non disponible')); return; }
                    const req = indexedDB.open(DB_NAME, DB_VERSION);
                    req.onupgradeneeded = e => {
                        const db = e.target.result;
                        if (!db.objectStoreNames.contains(STORE)) {
                            db.createObjectStore(STORE, { keyPath: 'ts' });
                        }
                    };
                    req.onsuccess = e => { _db = e.target.result; resolve(_db); };
                    req.onerror   = e => reject(e.target.error);
                });
            }

            // ── Sauvegarder un snapshot du localStorage ───────────
            function save() {
                open().then(db => {
                    // Collecter toutes les clés localStorage
                    const snap = { ts: Date.now(), data: {} };
                    for (let i = 0; i < localStorage.length; i++) {
                        const k = localStorage.key(i);
                        snap.data[k] = localStorage.getItem(k);
                    }
                    if (Object.keys(snap.data).length === 0) return; // rien à sauver

                    const tx    = db.transaction(STORE, 'readwrite');
                    const store = tx.objectStore(STORE);

                    // Ajouter le snapshot
                    store.add(snap);

                    // Limiter à MAX_SNAPS — supprimer les anciens
                    const allReq = store.getAll();
                    allReq.onsuccess = () => {
                        const all = allReq.result.sort((a, b) => a.ts - b.ts);
                        while (all.length > MAX_SNAPS) {
                            store.delete(all.shift().ts);
                        }
                    };
                }).catch(() => {}); // silencieux
            }

            // ── Récupérer le snapshot le plus récent ─────────────
            function getLatest() {
                return open().then(db => {
                    return new Promise((resolve, reject) => {
                        const tx    = db.transaction(STORE, 'readonly');
                        const store = tx.objectStore(STORE);
                        const req   = store.getAll();
                        req.onsuccess = () => {
                            const all = req.result.sort((a, b) => b.ts - a.ts);
                            resolve(all[0] || null);
                        };
                        req.onerror = () => resolve(null);
                    });
                }).catch(() => null);
            }

            // ── Vérifier si localStorage contient des données app ─
            function lsHasData() {
                for (let i = 0; i < localStorage.length; i++) {
                    const k = localStorage.key(i);
                    if (k.startsWith('week_') || k === 'employeeName' || k === 'companyName') {
                        return true;
                    }
                }
                return false;
            }

            // ── Restauration automatique au démarrage ─────────────
            function restoreIfNeeded() {
                // localStorage accessible et contient des données → rien à faire
                try {
                    if (lsHasData()) return Promise.resolve(false);
                } catch(e) {
                    // localStorage corrompu ou inaccessible → tenter la restauration
                }

                return getLatest().then(snap => {
                    if (!snap || !snap.data || Object.keys(snap.data).length === 0) {
                        return false; // IndexedDB aussi vide → premier lancement
                    }
                    // Restaurer toutes les clés dans localStorage
                    try {
                        Object.keys(snap.data).forEach(k => {
                            localStorage.setItem(k, snap.data[k]);
                        });
                    } catch(e) {
                        return false; // localStorage plein ou bloqué
                    }
                    return true; // restauration effectuée
                }).catch(() => false);
            }

            // ── Toast discret (restauration automatique) ──────────
            function showToast(msg) {
                const t = document.createElement('div');
                t.textContent = msg;
                t.style.cssText = [
                    'position:fixed', 'bottom:90px', 'left:50%',
                    'transform:translateX(-50%)',
                    'background:rgba(30,30,40,0.82)', 'color:#fff',
                    'padding:8px 18px', 'border-radius:20px',
                    'font-size:12px', 'font-family:\'Poppins\',sans-serif',
                    'z-index:9999', 'pointer-events:none',
                    'transition:opacity 0.4s ease', 'opacity:1'
                ].join(';');
                document.body.appendChild(t);
                setTimeout(() => { t.style.opacity = '0'; }, 2800);
                setTimeout(() => { t.remove(); }, 3300);
            }

            return { save, restoreIfNeeded, showToast, lsHasData };
        })();

        function saveAllData() {
            const data = { days: [] };

            for (let i = 0; i < 6; i++) {
                const dayData = {
                    am: {
                        client:   document.getElementById(`client_${i}_am`)?.value || '',
                        start:    document.getElementById(`start_${i}_am`)?.value  || '',
                        end:      document.getElementById(`end_${i}_am`)?.value    || '',
                        desc:     document.getElementById(`desc_${i}_am`)?.value   || '',
                        location: document.getElementById(`location_${i}_am`)?.value || '',
                        // Tableau des clients supplémentaires matin
                        extraClients: []
                    },
                    pm: {
                        client:   document.getElementById(`client_${i}_pm`)?.value || '',
                        start:    document.getElementById(`start_${i}_pm`)?.value  || '',
                        end:      document.getElementById(`end_${i}_pm`)?.value    || '',
                        desc:     document.getElementById(`desc_${i}_pm`)?.value   || '',
                        location: document.getElementById(`location_${i}_pm`)?.value || '',
                        // Tableau des clients supplémentaires après-midi
                        extraClients: []
                    },
                    km:      [],
                    meal:    document.getElementById(`meal_${i}`)?.checked || false,
                    expenses: []
                };

                // Sauver les clients supplémentaires (entrées dynamiques)
                ['am', 'pm'].forEach(period => {
                    const cards = document.querySelectorAll('.day-card');
                    if (!cards[i]) return;
                    const periodSections = cards[i].querySelectorAll('.period-section');
                    const section = period === 'am' ? periodSections[0] : periodSections[1];
                    if (!section) return;

                    section.querySelectorAll('.client-entry').forEach(entry => {
                        const entryId = entry.dataset.entryId;
                        if (!entryId) return;
                        dayData[period].extraClients.push({
                            id:       entryId,
                            client:   document.getElementById(`client_${i}_${period}_${entryId}`)?.value   || '',
                            start:    document.getElementById(`start_${i}_${period}_${entryId}`)?.value    || '',
                            end:      document.getElementById(`end_${i}_${period}_${entryId}`)?.value      || '',
                            desc:     document.getElementById(`desc_${i}_${period}_${entryId}`)?.value     || '',
                            location: document.getElementById(`location_${i}_${period}_${entryId}`)?.value || ''
                        });
                    });
                });

                // Sauver les km
                const kmDiv = document.getElementById(`km_${i}`);
                if (kmDiv) {
                    kmDiv.querySelectorAll('.expense-item').forEach(item => {
                        const desc   = item.querySelector('input[type="text"]')?.value;
                        const amount = item.querySelector('input[type="number"]')?.value;
                        if (desc || amount) dayData.km.push({ desc, amount });
                    });
                }

                // Sauver les frais
                const expDiv = document.getElementById(`expenses_${i}`);
                if (expDiv) {
                    expDiv.querySelectorAll('.expense-item').forEach(item => {
                        const desc   = item.querySelector('input[type="text"]')?.value;
                        const amount = item.querySelector('input[type="number"]')?.value;
                        if (desc || amount) dayData.expenses.push({ desc, amount });
                    });
                }

                data.days.push(dayData);
            }

            localStorage.setItem(getWeekKey(), JSON.stringify(data));
            localStorage.setItem('employeeName', document.getElementById('employeeName').value);
            localStorage.setItem('notes',         document.getElementById('notes')?.value         || '');
            localStorage.setItem('firstName',     document.getElementById('firstName')?.value     || '');
            localStorage.setItem('lastName',      document.getElementById('lastName')?.value      || '');
            localStorage.setItem('address',       document.getElementById('address')?.value       || '');
            localStorage.setItem('city',          document.getElementById('city')?.value          || '');
            localStorage.setItem('postalCode',    document.getElementById('postalCode')?.value    || '');
            localStorage.setItem('country',       document.getElementById('country')?.value       || '');
            localStorage.setItem('phone',         document.getElementById('phone')?.value         || '');
            localStorage.setItem('personalEmail', document.getElementById('personalEmail')?.value || '');
        }

        // ============================================================
        // loadWeekData : recharge les clients supplémentaires
        // ============================================================
        function loadWeekData() {
            const saved = localStorage.getItem(getWeekKey());
            if (saved) {
                const data = JSON.parse(saved);

                for (let i = 0; i < 6; i++) {
                    const day = data.days[i] || {};

                    ['am', 'pm'].forEach(period => {
                        const p = day[period] || {};
                        const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val || ''; };
                        set(`client_${i}_${period}`,   p.client);
                        set(`start_${i}_${period}`,    p.start);
                        set(`end_${i}_${period}`,      p.end);
                        set(`desc_${i}_${period}`,     p.desc);
                        set(`location_${i}_${period}`, p.location);

                        // Recharger les clients supplémentaires
                        if (p.extraClients && p.extraClients.length > 0) {
                            p.extraClients.forEach(ec => {
                                addClientEntry(i, period, ec);
                            });
                        }
                    });

                    if (document.getElementById(`meal_${i}`))
                        document.getElementById(`meal_${i}`).checked = day.meal || false;

                    // Recharger les KM
                    if (day.km && day.km.length > 0) {
                        const kmContainer = document.getElementById(`km_${i}`);
                        if (kmContainer) {
                            kmContainer.innerHTML = '';
                            day.km.forEach(km => {
                                const kmDiv = document.createElement('div');
                                kmDiv.className = 'expense-item';
                                kmDiv.innerHTML = `
                                    <input type="text" value="${km.desc || ''}"
                                           placeholder="Description du trajet"
                                           aria-label="Description du trajet"
                                           onchange="debouncedSave();" />
                                    <input type="number" value="${km.amount || ''}"
                                           placeholder="0" step="1"
                                           aria-label="Kilomètres"
                                           onchange="debouncedSave(); calculateTotals();" />
                                    <button class="remove-expense-btn"
                                            aria-label="Supprimer ce trajet"
                                            data-action="remove-item">×</button>
                                `;
                                kmContainer.appendChild(kmDiv);
                            });
                        }
                    }

                    // Recharger les frais
                    if (day.expenses && day.expenses.length > 0) {
                        const container = document.getElementById(`expenses_${i}`);
                        if (container) {
                            container.innerHTML = '';
                            day.expenses.forEach(expense => {
                                const expenseDiv = document.createElement('div');
                                expenseDiv.className = 'expense-item';
                                expenseDiv.innerHTML = `
                                    <input type="text" value="${expense.desc || ''}"
                                           placeholder="Description"
                                           aria-label="Description du frais"
                                           onchange="debouncedSave();" />
                                    <input type="number" value="${expense.amount || ''}"
                                           placeholder="0.00" step="0.05"
                                           aria-label="Montant"
                                           onchange="debouncedSave(); calculateTotals();" />
                                    <button class="remove-expense-btn"
                                            aria-label="Supprimer ce frais"
                                            data-action="remove-item">×</button>
                                `;
                                container.appendChild(expenseDiv);
                            });
                        }
                    }

                    calculateDayHours(i);
                }
            }

            const savedName = localStorage.getItem('employeeName');
            if (savedName) document.getElementById('employeeName').value = savedName;

            const fields = ['notes','firstName','lastName','address','city','postalCode','country','phone','personalEmail'];
            fields.forEach(f => {
                const val = localStorage.getItem(f);
                const el  = document.getElementById(f);
                if (val && el) el.value = val;
            });
        }

        function clearWeek() {
            if (confirm('Effacer toutes les données de cette semaine ?')) {
                localStorage.removeItem(getWeekKey());
                renderWeek();
            }
        }

        // ============================================================
        // renderCalendar : dimanches grisés et non cliquables
        // ============================================================
        function renderCalendar() {
            const today = new Date();
            const currentMonth = calendarViewMonth.getMonth();
            const currentYear  = calendarViewMonth.getFullYear();

            document.getElementById('calendarHeader').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay  = new Date(currentYear, currentMonth + 1, 0);
            const startDay = firstDay.getDay();

            // Jours avec heures saisies (indicateurs visuels)
            const daysWithHours = new Set();
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('week_')) {
                    try {
                        const weekData = JSON.parse(localStorage.getItem(key));
                        if (weekData?.days) {
                            const weekDate = new Date(key.replace('week_', ''));
                            weekData.days.forEach((day, i) => {
                                const dayDate = new Date(weekDate);
                                dayDate.setDate(dayDate.getDate() + i);
                                if (dayDate.getMonth() === currentMonth && dayDate.getFullYear() === currentYear) {
                                    if (['am','pm'].some(p => day[p]?.start || day[p]?.end))
                                        daysWithHours.add(dayDate.getDate());
                                }
                            });
                        }
                    } catch(e) {}
                }
            });

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            dayLabels.forEach(label => {
                const dayLabel = document.createElement('div');
                dayLabel.className = 'calendar-day-label';
                dayLabel.textContent = label;
                grid.appendChild(dayLabel);
            });

            // Jours mois précédent
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = prevMonthLastDay - i;
                grid.appendChild(day);
            }

            // Jours mois actuel
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const day = document.createElement('div');
                const dayDate    = new Date(currentYear, currentMonth, i);
                const dayOfWeek  = dayDate.getDay(); // 0 = dimanche

                day.textContent = i;

                if (dayDate.toDateString() === today.toDateString()) day.classList.add('today');
                if (daysWithHours.has(i)) day.classList.add('has-hours');

                // Dimanches : grisés et non interactifs
                if (dayOfWeek === 0) {
                    day.className = 'calendar-day calendar-sunday';
                    day.title = 'Dimanche — non travaillé';
                    day.setAttribute('aria-disabled', 'true');
                    // Pas de onclick
                } else {
                    day.className = 'calendar-day';
                    if (dayDate.toDateString() === today.toDateString()) day.classList.add('today');
                    if (daysWithHours.has(i)) day.classList.add('has-hours');

                    day.onclick = () => {
                        const clickedDate  = new Date(currentYear, currentMonth, i);
                        const mondayOffset = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                        currentWeekStart   = new Date(clickedDate);
                        currentWeekStart.setDate(clickedDate.getDate() + mondayOffset);
                        calendarViewMonth = new Date(currentWeekStart);
                        loadWeekData();
                        renderWeek();
                        setTimeout(() => {
                            const dayCards     = document.querySelectorAll('.day-card');
                            const targetIndex  = dayOfWeek - 1; // lundi=0
                            if (dayCards[targetIndex])
                                dayCards[targetIndex].scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    };
                }

                grid.appendChild(day);
            }

            // Jours mois suivant
            const remainingDays = 7 - (grid.children.length - 7) % 7;
            if (remainingDays < 7) {
                for (let i = 1; i <= remainingDays; i++) {
                    const day = document.createElement('div');
                    day.className = 'calendar-day other-month';
                    day.textContent = i;
                    grid.appendChild(day);
                }
            }
        }

        function exportToExcel() {
            const company = document.getElementById('companyName').value || 'Entreprise';
            const name    = document.getElementById('employeeName').value || 'Employé';
            const wb      = XLSX.utils.book_new();

            const endDateExport = new Date(currentWeekStart);
            endDateExport.setDate(endDateExport.getDate() + 5);

            // ── Couleurs et styles ──
            // En-tête principal (rouge MesHeures)
            const sHeader = { font: { bold: true, sz: 14, color: { rgb: 'FFFFFF' } }, fill: { fgColor: { rgb: 'FD636B' } }, alignment: { horizontal: 'left', vertical: 'center' } };
            // Sous-en-tête info (gris foncé)
            const sInfo   = { font: { bold: true, sz: 9,  color: { rgb: 'FFFFFF' } }, fill: { fgColor: { rgb: '444444' } }, alignment: { horizontal: 'left' } };
            const sInfoVal= { font: { sz: 9,  color: { rgb: 'FFFFFF' } }, fill: { fgColor: { rgb: '444444' } }, alignment: { horizontal: 'left' } };
            // En-tête colonnes (noir)
            const sColHead= { font: { bold: true, sz: 9, color: { rgb: 'FFFFFF' } }, fill: { fgColor: { rgb: '222222' } }, alignment: { horizontal: 'center', vertical: 'center' }, border: { bottom: { style: 'thin', color: { rgb: 'AAAAAA' } } } };
            // Lignes de données — couleur paire / impaire par JOUR
            const sDayA   = { font: { sz: 9 }, fill: { fgColor: { rgb: 'FFFFFF' } }, alignment: { vertical: 'center' } };
            const sDayB   = { font: { sz: 9 }, fill: { fgColor: { rgb: 'F7F7F7' } }, alignment: { vertical: 'center' } };
            const sDayABold = { font: { bold: true, sz: 9 }, fill: { fgColor: { rgb: 'FFFFFF' } }, alignment: { vertical: 'center' } };
            const sDayBBold = { font: { bold: true, sz: 9 }, fill: { fgColor: { rgb: 'F7F7F7' } }, alignment: { vertical: 'center' } };
            // Lignes spéciales : frais / repas (léger fond rosé)
            const sSpecA  = { font: { sz: 9, color: { rgb: '888888' }, italic: true }, fill: { fgColor: { rgb: 'FFF5F5' } }, alignment: { vertical: 'center' } };
            const sSpecB  = { font: { sz: 9, color: { rgb: '888888' }, italic: true }, fill: { fgColor: { rgb: 'FFF5F5' } }, alignment: { vertical: 'center' } };
            // Totaux
            const sTotHead= { font: { bold: true, sz: 10, color: { rgb: 'FFFFFF' } }, fill: { fgColor: { rgb: '222222' } } };
            const sTotLbl = { font: { bold: true, sz: 9 }, fill: { fgColor: { rgb: 'F0F0F0' } } };
            const sTotVal = { font: { bold: true, sz: 9, color: { rgb: 'FD636B' } }, fill: { fgColor: { rgb: 'F0F0F0' } }, alignment: { horizontal: 'right' } };

            const ws = {};
            const cols = 11; // A–K
            let r = 0; // row index (0-based)

            function setCell(row, col, value, style) {
                const addr = XLSX.utils.encode_cell({ r: row, c: col });
                ws[addr] = { v: value, t: typeof value === 'number' ? 'n' : 's', s: style };
            }
            function mergeCells(r1, c1, r2, c2) {
                if (!ws['!merges']) ws['!merges'] = [];
                ws['!merges'].push({ s: { r: r1, c: c1 }, e: { r: r2, c: c2 } });
            }

            // ── Ligne 1 : en-tête entreprise ──
            setCell(r, 0, company.toUpperCase(), sHeader);
            for (let c = 1; c < cols; c++) setCell(r, c, '', sHeader);
            mergeCells(r, 0, r, cols - 1);
            r++;

            // ── Ligne 2 : sous-titre ──
            setCell(r, 0, 'FEUILLE HEBDOMADAIRE', sInfo);
            for (let c = 1; c < cols; c++) setCell(r, c, '', sInfo);
            mergeCells(r, 0, r, cols - 1);
            r++;

            // ── Lignes 3-4 : infos employé / semaine ──
            const infoRows = [
                ['Employé', name, 'Semaine', `${formatDateFull(currentWeekStart)} — ${formatDateFull(endDateExport)}`],
                ['Export', new Date().toLocaleDateString('fr-CH'), '', '']
            ];
            infoRows.forEach(row => {
                setCell(r, 0, row[0], sInfo);
                setCell(r, 1, row[1], sInfoVal);
                mergeCells(r, 1, r, 4);
                setCell(r, 5, row[2], sInfo);
                setCell(r, 6, row[3], sInfoVal);
                mergeCells(r, 6, r, cols - 1);
                for (let c = 2; c <= 4; c++) setCell(r, c, '', sInfoVal);
                for (let c = 7; c < cols; c++) setCell(r, c, '', sInfoVal);
                r++;
            });

            // ── Ligne vide ──
            r++;

            // ── En-tête colonnes ──
            const headers = ['Date', 'Jour', 'Période', 'Client', 'Début', 'Fin', 'Heures', 'Description', 'Lieu', 'KM', 'Frais/Repas'];
            headers.forEach((h, c) => setCell(r, c, h, sColHead));
            r++;

            // ── Données par jour ──
            let dayParity = 0; // alterne 0/1 par jour

            for (let i = 0; i < 6; i++) {
                const date    = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                const kmDiv   = document.getElementById(`km_${i}`);
                const kmTotal = kmDiv ? Array.from(kmDiv.querySelectorAll('input[type="number"]'))
                    .reduce((sum, inp) => sum + (parseFloat(inp.value) || 0), 0) : 0;
                const km      = kmTotal > 0 ? String(kmTotal) : '';
                const meal    = document.getElementById(`meal_${i}`)?.checked;
                let dayHasData = false;
                let dayHasAnyRow = false;

                const sNorm     = dayParity === 0 ? sDayA  : sDayB;
                const sNormBold = dayParity === 0 ? sDayABold : sDayBBold;
                const sSpec     = dayParity === 0 ? sSpecA : sSpecB;

                // Périodes
                ['am', 'pm'].forEach(period => {
                    const start  = document.getElementById(`start_${i}_${period}`)?.value;
                    const end    = document.getElementById(`end_${i}_${period}`)?.value;
                    const client = document.getElementById(`client_${i}_${period}`)?.value;
                    if (!((start && start !== '--:--') || (end && end !== '--:--') || client)) return;

                    let minutes = 0;
                    if (start && start !== '--:--' && end && end !== '--:--') {
                        const [sH, sM] = start.split(':').map(Number);
                        const [eH, eM] = end.split(':').map(Number);
                        minutes = (eH * 60 + eM) - (sH * 60 + sM);
                        if (minutes < 0) minutes += 1440;
                    }
                    const h = Math.floor(minutes / 60), m = minutes % 60;

                    const rowData = [
                        !dayHasData ? formatDateFull(date) : '',
                        !dayHasData ? daysOfWeek[date.getDay()] : '',
                        period === 'am' ? 'Matin' : 'Après-midi',
                        client || '',
                        (start && start !== '--:--') ? start : '',
                        (end && end !== '--:--') ? end : '',
                        minutes > 0 ? `${h}h${String(m).padStart(2,'0')}` : '',
                        document.getElementById(`desc_${i}_${period}`)?.value || '',
                        document.getElementById(`location_${i}_${period}`)?.value || '',
                        !dayHasData ? km : '',
                        (!dayHasData && period === 'pm' && meal) ? 'Oui' : ''
                    ];
                    rowData.forEach((v, c) => {
                        const s = (c === 6) ? sNormBold : sNorm; // heures en gras
                        setCell(r, c, v, s);
                    });
                    r++; dayHasData = true; dayHasAnyRow = true;

                    // Clients supplémentaires
                    const cards = document.querySelectorAll('.day-card');
                    if (cards[i]) {
                        const sections = cards[i].querySelectorAll('.period-section');
                        const section  = period === 'am' ? sections[0] : sections[1];
                        section?.querySelectorAll('.client-entry').forEach(entry => {
                            const eid = entry.dataset.entryId;
                            if (!eid) return;
                            const es = document.getElementById(`start_${i}_${period}_${eid}`)?.value || '';
                            const ee = document.getElementById(`end_${i}_${period}_${eid}`)?.value   || '';
                            const ec = document.getElementById(`client_${i}_${period}_${eid}`)?.value || '';
                            let em2 = 0;
                            if (es && es !== '--:--' && ee && ee !== '--:--') {
                                const [sh,sm]=es.split(':').map(Number), [eh,em]=ee.split(':').map(Number);
                                em2=(eh*60+em)-(sh*60+sm); if(em2<0)em2+=1440;
                            }
                            const eh2=Math.floor(em2/60), em2r=em2%60;
                            const xData = [
                                '', '',
                                (period==='am'?'Matin':'Après-midi')+' (+)',
                                ec,
                                es!=='--:--'?es:'', ee!=='--:--'?ee:'',
                                em2>0?`${eh2}h${String(em2r).padStart(2,'0')}`:'',
                                document.getElementById(`desc_${i}_${period}_${eid}`)?.value||'',
                                document.getElementById(`location_${i}_${period}_${eid}`)?.value||'',
                                '', ''
                            ];
                            xData.forEach((v,c) => setCell(r, c, v, sNorm));
                            r++; dayHasAnyRow = true;
                        });
                    }
                });

                // Frais
                const expDiv = document.getElementById(`expenses_${i}`);
                if (expDiv) {
                    expDiv.querySelectorAll('.expense-item').forEach(item => {
                        const desc   = item.querySelector('input[type="text"]')?.value;
                        const amount = item.querySelector('input[type="number"]')?.value;
                        if (!desc && !amount) return;
                        const fData = [
                            !dayHasData ? formatDateFull(date) : '',
                            !dayHasData ? daysOfWeek[date.getDay()] : '',
                            'Frais', desc||'','','','','','','',
                            amount ? `${amount} CHF` : ''
                        ];
                        fData.forEach((v,c) => setCell(r, c, v, sSpec));
                        r++; dayHasData = true; dayHasAnyRow = true;
                    });
                }

                // Repas
                if (meal) {
                    const rData = [
                        !dayHasData ? formatDateFull(date) : '',
                        !dayHasData ? daysOfWeek[date.getDay()] : '',
                        'Repas','','','','','','','','✓'
                    ];
                    rData.forEach((v,c) => setCell(r, c, v, sSpec));
                    r++; dayHasAnyRow = true;
                }

                if (dayHasAnyRow) dayParity = 1 - dayParity;
            }

            // ── Ligne vide + totaux ──
            r++;
            setCell(r, 0, 'TOTAUX DE LA SEMAINE', sTotHead);
            for (let c = 1; c < cols; c++) setCell(r, c, '', sTotHead);
            mergeCells(r, 0, r, cols - 1);
            r++;

            const totals = [
                ['Total heures',     document.getElementById('weekHours').textContent],
                ['Total kilomètres', document.getElementById('weekKm').textContent + ' km'],
                ['Total repas',      document.getElementById('weekMeals').textContent],
                ['Total frais',      document.getElementById('weekExpenses').textContent + ' CHF'],
            ];
            totals.forEach(([label, val]) => {
                setCell(r, 0, label, sTotLbl);
                for (let c = 1; c < cols - 1; c++) setCell(r, c, '', sTotLbl);
                setCell(r, cols - 1, val, sTotVal);
                r++;
            });

            // ── Dimensions ──
            ws['!ref'] = XLSX.utils.encode_range({ s: { r: 0, c: 0 }, e: { r: r - 1, c: cols - 1 } });
            ws['!cols'] = [
                { wch: 12 }, // Date
                { wch: 11 }, // Jour
                { wch: 14 }, // Période
                { wch: 22 }, // Client
                { wch:  7 }, // Début
                { wch:  7 }, // Fin
                { wch:  8 }, // Heures
                { wch: 28 }, // Description
                { wch: 18 }, // Lieu
                { wch:  6 }, // KM
                { wch: 12 }, // Frais/Repas
            ];
            // Hauteurs : en-tête un peu plus haut
            ws['!rows'] = [{ hpt: 22 }, { hpt: 16 }, { hpt: 14 }, { hpt: 14 }, null, { hpt: 16 }];

            XLSX.utils.book_append_sheet(wb, ws, 'Feuille Heures');
            XLSX.writeFile(wb,
                `${company.replace(/\s/g,'_')}_${name.replace(/\s/g,'_')}_${formatDateFull(currentWeekStart).replace(/\//g,'-')}.xlsx`
            );

            const btn = event.target;
            const orig = btn.textContent;
            btn.textContent = '✓';
            setTimeout(() => { btn.textContent = orig; }, 1500);
        }


        // ============================================================
        // EXPORT PDF — jsPDF, primitives PDF universelles uniquement
        // Compatible Google PDF Viewer, Apple Books, Acrobat, etc.
        // Pas de roundedRect ni de mode 'FD' (non supportés partout)
        // ============================================================
        function exportToPDF() {
            if (!window.jspdf) {
                alert('Librairie PDF non chargée. Vérifiez votre connexion Internet.');
                return;
            }
            const { jsPDF } = window.jspdf;

            // ── Données de base ──────────────────────────────────────
            const name    = (document.getElementById('employeeName')?.value || 'Employé').trim();
            const company = (document.getElementById('companyName')?.value  || 'Entreprise').trim();
            const endDate = new Date(currentWeekStart);
            endDate.setDate(endDate.getDate() + 5);
            const weekStr  = `${formatDateFull(currentWeekStart)} – ${formatDateFull(endDate)}`;
            const todayStr = new Date().toLocaleDateString('fr-CH');

            // ── Mise en page ─────────────────────────────────────────
            const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
            const PW  = 210;          // largeur page A4
            const ML  = 14;           // marge gauche
            const MR  = 14;           // marge droite
            const CW  = PW - ML - MR; // largeur contenu = 182 mm
            const PH  = 297;          // hauteur page A4

            // ── Palette couleurs (RGB entiers uniquement) ─────────────
            const RED   = [60, 60, 80];   // en-tête sobre (gris ardoise)
            const DARK  = [30, 30, 30];
            const MID   = [110, 110, 110];
            const LGREY = [245, 245, 248];
            const MGREY = [200, 200, 200];
            const WHITE = [255, 255, 255];
            const SPEC  = [240, 240, 245]; // lignes frais/repas — gris très doux

            // ── Helpers ───────────────────────────────────────────────
            // Rect rempli (fond uniquement)
            function fillRect(x, y, w, h, rgb) {
                doc.setFillColor(rgb[0], rgb[1], rgb[2]);
                doc.rect(x, y, w, h, 'F');
            }
            // Rect contour uniquement
            function strokeRect(x, y, w, h, rgb, lw) {
                doc.setDrawColor(rgb[0], rgb[1], rgb[2]);
                doc.setLineWidth(lw || 0.3);
                doc.rect(x, y, w, h, 'S');
            }
            // Rect rempli + contour (deux appels séparés pour compatibilité max)
            function fillStrokeRect(x, y, w, h, fillRgb, strokeRgb, lw) {
                doc.setFillColor(fillRgb[0], fillRgb[1], fillRgb[2]);
                doc.rect(x, y, w, h, 'F');
                doc.setDrawColor(strokeRgb[0], strokeRgb[1], strokeRgb[2]);
                doc.setLineWidth(lw || 0.3);
                doc.rect(x, y, w, h, 'S');
            }
            // Ligne horizontale
            function hLine(y, x1, x2, rgb, lw) {
                doc.setDrawColor(rgb[0], rgb[1], rgb[2]);
                doc.setLineWidth(lw || 0.2);
                doc.line(x1 || ML, y, x2 || ML + CW, y);
            }
            // Ligne verticale
            function vLine(x, y1, y2, rgb, lw) {
                doc.setDrawColor(rgb[0], rgb[1], rgb[2]);
                doc.setLineWidth(lw || 0.15);
                doc.line(x, y1, x, y2);
            }
            // Texte avec style
            function txt(str, x, y, opts) {
                if (!str) return;
                doc.text(String(str), x, y, opts || {});
            }
            // Tronquer un texte pour qu'il tienne dans maxW mm
            function truncate(str, maxW) {
                if (!str) return '';
                let s = str;
                while (s.length > 1 && doc.getTextWidth(s) > maxW) {
                    s = s.slice(0, -1);
                }
                return s.length < str.length ? s + '…' : s;
            }

            // ── PIED DE PAGE (fonction réutilisable) ─────────────────
            function drawFooter(pageNum, totalPages) {
                fillRect(0, PH - 9, PW, 9, [238, 238, 238]);
                hLine(PH - 9, 0, PW, MGREY, 0.3);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(6.5);
                doc.setTextColor(MID[0], MID[1], MID[2]);
                txt('MesHeures — smims909', ML, PH - 3.5);
                txt(`Page ${pageNum} / ${totalPages}`, PW / 2, PH - 3.5, { align: 'center' });
                txt('Généré le ' + todayStr, ML + CW, PH - 3.5, { align: 'right' });
            }

            // ── EN-TÊTE ───────────────────────────────────────────────
            fillRect(0, 0, PW, 28, RED);

            // Ligne blanche décorative en bas du header
            hLine(25.5, 0, PW, WHITE, 0.5);

            // Nom entreprise
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.setTextColor(WHITE[0], WHITE[1], WHITE[2]);
            txt(company.toUpperCase(), ML, 15);

            // Sous-titre + date (côté droit)
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(8);
            doc.setTextColor(200, 205, 215);
            txt("FEUILLE D'HEURES HEBDOMADAIRE", ML + CW, 10, { align: 'right' });
            doc.setTextColor(215, 218, 225);
            txt('Édité le ' + todayStr, ML + CW, 15, { align: 'right' });

            let y = 33;

            // ── BLOC INFOS EMPLOYÉ / SEMAINE ──────────────────────────
            const INFO_H = 18;
            fillStrokeRect(ML, y, CW, INFO_H, LGREY, MGREY, 0.3);

            // Séparateur vertical central
            vLine(ML + CW / 2 - 4, y + 3, y + INFO_H - 3, MGREY, 0.3);

            // Colonne gauche
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(MID[0], MID[1], MID[2]);
            txt('Employé', ML + 5, y + 7);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(DARK[0], DARK[1], DARK[2]);
            txt(name, ML + 5 + doc.getTextWidth('Employé') + 4, y + 7);

            // Colonne droite
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(MID[0], MID[1], MID[2]);
            txt('Semaine', ML + CW / 2, y + 7);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(DARK[0], DARK[1], DARK[2]);
            txt(weekStr, ML + CW / 2 + doc.getTextWidth('Semaine') + 4, y + 7);

            // Ligne 2 : nom complet + contact
            const firstName = (document.getElementById('firstName')?.value || '').trim();
            const lastName  = (document.getElementById('lastName')?.value  || '').trim();
            const phone     = (document.getElementById('phone')?.value     || '').trim();
            const email     = (document.getElementById('personalEmail')?.value || '').trim();
            const addr      = (document.getElementById('address')?.value   || '').trim();
            const city      = (document.getElementById('city')?.value      || '').trim();
            const postal    = (document.getElementById('postalCode')?.value|| '').trim();
            const countryVal= (document.getElementById('country')?.value   || '').trim();
            const fullName  = [firstName, lastName].filter(Boolean).join(' ');
            const cityLine  = [postal, city].filter(Boolean).join(' ');

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(8);
            doc.setTextColor(MID[0], MID[1], MID[2]);
            if (fullName) txt(fullName, ML + 5, y + 13);
            if (phone || email) {
                const contact = [phone, email].filter(Boolean).join('  •  ');
                txt(contact, ML + CW / 2, y + 13);
            }

            y += INFO_H + 5;

            // ── CONSTRUCTION DES LIGNES DU TABLEAU ────────────────────
            // Chaque row : { jourStr, dateStr, period, client, horaire, hStr, km, frais, repas, isNew, isSpec, dayIdx }
            const rows = [];

            for (let i = 0; i < 6; i++) {
                const date    = new Date(currentWeekStart);
                date.setDate(date.getDate() + i);
                const dateStr = formatDate(date);
                const jourStr = daysOfWeek[date.getDay()];

                const kmDiv   = document.getElementById(`km_${i}`);
                const kmTotal = kmDiv
                    ? Array.from(kmDiv.querySelectorAll('input[type="number"]'))
                          .reduce((s, inp) => s + (parseFloat(inp.value) || 0), 0)
                    : 0;
                const meal    = document.getElementById(`meal_${i}`)?.checked || false;

                let isFirst    = true;
                let dayHasRows = false;

                // Périodes AM / PM
                ['am', 'pm'].forEach(period => {
                    const client = (document.getElementById(`client_${i}_${period}`)?.value || '').trim();
                    const start  = document.getElementById(`start_${i}_${period}`)?.value || '';
                    const end    = document.getElementById(`end_${i}_${period}`)?.value   || '';
                    const desc   = (document.getElementById(`desc_${i}_${period}`)?.value || '').trim();
                    if (!client && (!start || start === '--:--') && !desc) return;

                    let mins = 0;
                    if (start && start !== '--:--' && end && end !== '--:--') {
                        const [sh, sm] = start.split(':').map(Number);
                        const [eh, em] = end.split(':').map(Number);
                        mins = (eh * 60 + em) - (sh * 60 + sm);
                        if (mins < 0) mins += 1440;
                    }
                    const hStr    = mins > 0 ? `${Math.floor(mins/60)}h${String(mins%60).padStart(2,'0')}` : '';
                    const horaire = (start && start !== '--:--' && end && end !== '--:--')
                        ? `${start} – ${end}` : '';

                    rows.push({
                        jourStr: isFirst ? jourStr : '',
                        dateStr: isFirst ? dateStr : '',
                        period:  period === 'am' ? 'Matin' : 'Après-midi',
                        client, horaire, hStr,
                        km:     isFirst && kmTotal > 0 ? `${kmTotal} km` : '',
                        frais: '', repas: false,
                        isNew: isFirst, isSpec: false, dayIdx: i
                    });
                    isFirst = false; dayHasRows = true;

                    // Clients supplémentaires
                    const cards = document.querySelectorAll('.day-card');
                    if (cards[i]) {
                        const pSections = cards[i].querySelectorAll('.period-section');
                        const section = period === 'am' ? pSections[0] : pSections[1];
                        section?.querySelectorAll('.client-entry').forEach(entry => {
                            const eid = entry.dataset.entryId;
                            if (!eid) return;
                            const ec = (document.getElementById(`client_${i}_${period}_${eid}`)?.value || '').trim();
                            const es = document.getElementById(`start_${i}_${period}_${eid}`)?.value || '';
                            const ee = document.getElementById(`end_${i}_${period}_${eid}`)?.value   || '';
                            let em2 = 0;
                            if (es && es !== '--:--' && ee && ee !== '--:--') {
                                const [sh, sm] = es.split(':').map(Number);
                                const [eh, em] = ee.split(':').map(Number);
                                em2 = (eh * 60 + em) - (sh * 60 + sm);
                                if (em2 < 0) em2 += 1440;
                            }
                            const hs2  = em2 > 0 ? `${Math.floor(em2/60)}h${String(em2%60).padStart(2,'0')}` : '';
                            const hor2 = (es && es !== '--:--' && ee && ee !== '--:--') ? `${es} – ${ee}` : '';
                            rows.push({
                                jourStr: '', dateStr: '',
                                period: period === 'am' ? 'Matin' : 'Après-midi',
                                client: ec, horaire: hor2, hStr: hs2,
                                km: '', frais: '', repas: false,
                                isNew: false, isSpec: false, dayIdx: i
                            });
                            dayHasRows = true;
                        });
                    }
                });

                // Frais
                const expDiv = document.getElementById(`expenses_${i}`);
                if (expDiv) {
                    expDiv.querySelectorAll('.expense-item').forEach(item => {
                        const desc   = (item.querySelector('input[type="text"]')?.value   || '').trim();
                        const amount = (item.querySelector('input[type="number"]')?.value || '').trim();
                        if (!desc && !amount) return;
                        const amtStr = amount ? `${parseFloat(amount).toFixed(2)} CHF` : '';
                        rows.push({
                            jourStr: isFirst ? jourStr : '',
                            dateStr: isFirst ? dateStr : '',
                            period: 'Frais', client: desc,
                            horaire: '', hStr: '', km: '', frais: amtStr, repas: false,
                            isNew: isFirst, isSpec: true, dayIdx: i
                        });
                        isFirst = false; dayHasRows = true;
                    });
                }

                // Repas
                if (meal) {
                    rows.push({
                        jourStr: isFirst ? jourStr : '',
                        dateStr: isFirst ? dateStr : '',
                        period: 'Repas', client: '',
                        horaire: '', hStr: '', km: '', frais: '', repas: true,
                        isNew: isFirst, isSpec: true, dayIdx: i
                    });
                    dayHasRows = true;
                }
            }

            // ── COLONNES DU TABLEAU ───────────────────────────────────
            // Largeurs (mm) — total = CW = 182
            const COL = { jour: 32, period: 22, client: 52, horaire: 30, heures: 16, km: 14, frais: 16 };
            // Positions X
            const xJour    = ML;
            const xPeriod  = xJour    + COL.jour;
            const xClient  = xPeriod  + COL.period;
            const xHoraire = xClient  + COL.client;
            const xHeures  = xHoraire + COL.horaire;
            const xKm      = xHeures  + COL.heures;
            const xFrais   = xKm      + COL.km;
            const xEnd     = xFrais   + COL.frais; // = ML + CW

            const ROW_H  = 7;   // hauteur ligne données
            const HEAD_H = 8;   // hauteur ligne en-tête tableau
            const FOOT   = 12;  // espace réservé pied de page
            const TOT_H  = 42;  // espace totaux + marge
            let pageNum  = 1;

            // ── DESSIN EN-TÊTE TABLEAU (réutilisable) ─────────────────
            function drawTableHeader(yh) {
                fillRect(ML, yh, CW, HEAD_H, DARK);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(7.5);
                doc.setTextColor(WHITE[0], WHITE[1], WHITE[2]);
                const hy = yh + 5.5;
                txt('JOUR / DATE',  xJour    + 3,            hy);
                txt('PÉRIODE',      xPeriod  + 2,            hy);
                txt('CLIENT',       xClient  + 2,            hy);
                txt('HORAIRE',      xHoraire + 2,            hy);
                txt('HEURES',       xHeures  + COL.heures/2, hy, { align: 'center' });
                txt('KM',           xKm      + COL.km/2,     hy, { align: 'center' });
                txt('FRAIS',        xFrais   + COL.frais/2,  hy, { align: 'center' });
                return yh + HEAD_H;
            }

            // ── SAUT DE PAGE ──────────────────────────────────────────
            function newPage() {
                // Pas de pied de page ici — on les dessine tous à la fin
                doc.addPage();
                pageNum++;
                y = 14;
                y = drawTableHeader(y);
            }

            // ── ALTERNANCE COULEUR PAR JOUR ───────────────────────────
            const dayBg = {};
            let colorToggle = 0;
            rows.forEach(row => {
                if (!(row.dayIdx in dayBg)) {
                    dayBg[row.dayIdx] = colorToggle;
                    colorToggle = 1 - colorToggle;
                }
            });
            const bgColors = [WHITE, LGREY];

            // ── DESSIN DE L'EN-TÊTE TABLEAU ───────────────────────────
            y = drawTableHeader(y);

            // ── LIGNES VIDES si pas de données ───────────────────────
            if (rows.length === 0) {
                fillRect(ML, y, CW, ROW_H * 2, LGREY);
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(9);
                doc.setTextColor(MID[0], MID[1], MID[2]);
                txt('Aucune donnée pour cette semaine.', ML + CW / 2, y + ROW_H, { align: 'center' });
                y += ROW_H * 2;
            }

            // ── DESSIN DES LIGNES ─────────────────────────────────────
            rows.forEach((row) => {
                // Saut de page si besoin (réserver place pour totaux sur dernière ligne)
                const isLast = rows.indexOf(row) === rows.length - 1;
                const reservedSpace = isLast ? TOT_H : ROW_H + 2;
                if (y + reservedSpace > PH - FOOT) newPage();

                const bg = row.isSpec ? SPEC : bgColors[dayBg[row.dayIdx] ?? 0];
                fillRect(ML, y, CW, ROW_H, bg);

                // Trait subtil gauche = première ligne du jour
                if (row.isNew) {
                    fillRect(ML, y, 1.5, ROW_H, [180, 180, 195]);
                }

                // Traits verticaux de séparation de colonnes
                [xPeriod, xClient, xHoraire, xHeures, xKm, xFrais].forEach(xv => {
                    vLine(xv, y, y + ROW_H, MGREY, 0.1);
                });

                // Trait horizontal bas de ligne
                hLine(y + ROW_H, ML, xEnd, [230, 230, 230], 0.15);

                const ty = y + 4.8; // baseline texte

                // Col 1 — Jour + date
                if (row.jourStr) {
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(8);
                    doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                    txt(row.jourStr, ML + 4, ty);
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(MID[0], MID[1], MID[2]);
                    txt(row.dateStr, ML + 4 + doc.getTextWidth(row.jourStr) + 1.5, ty);
                }

                // Col 2 — Période
                if (row.isSpec) {
                    doc.setFont('helvetica', 'italic');
                    doc.setFontSize(7.5);
                    doc.setTextColor(90, 90, 110);
                } else {
                    doc.setFont('helvetica', row.period === 'Matin' ? 'bold' : 'normal');
                    doc.setFontSize(7.5);
                    doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                }
                txt(row.period, xPeriod + 2, ty);

                // Col 3 — Client
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                if (row.repas) {
                    doc.setFont('helvetica', 'italic');
                    doc.setTextColor(MID[0], MID[1], MID[2]);
                    txt('Repas remboursé', xClient + 2, ty);
                } else if (row.client) {
                    doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                    txt(truncate(row.client, COL.client - 4), xClient + 2, ty);
                }

                // Col 4 — Horaire
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                if (row.horaire) txt(row.horaire, xHoraire + 2, ty);

                // Col 5 — Heures (centré, rouge gras)
                if (row.hStr) {
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(8);
                    doc.setTextColor(RED[0], RED[1], RED[2]);
                    txt(row.hStr, xHeures + COL.heures / 2, ty, { align: 'center' });
                }

                // Col 6 — KM (centré)
                if (row.km) {
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7.5);
                    doc.setTextColor(MID[0], MID[1], MID[2]);
                    txt(row.km, xKm + COL.km / 2, ty, { align: 'center' });
                }

                // Col 7 — Frais / Repas (aligné droite)
                const fraisVal = row.frais || (row.repas ? '✓' : '');
                if (fraisVal) {
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(7.5);
                    doc.setTextColor(row.repas ? 60 : 180, row.repas ? 140 : 60, row.repas ? 60 : 60);
                    txt(fraisVal, xFrais + COL.frais - 2, ty, { align: 'right' });
                }

                y += ROW_H;
            });

            // Bord bas du tableau
            hLine(y, ML, xEnd, DARK, 0.4);
            y += 8;

            // ── TOTAUX ────────────────────────────────────────────────
            const BW     = 82;            // largeur bloc totaux
            const BX     = ML + CW - BW;  // position X gauche du bloc
            const TRWH   = 6.5;           // hauteur ligne total

            // Saut de page si besoin
            if (y + 40 > PH - FOOT) {
                doc.addPage();
                pageNum++;
                y = 14;
            }

            // Titre du bloc totaux
            fillRect(BX, y, BW, 8, DARK);
            hLine(y, BX, BX + BW, DARK, 0.4);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(8);
            doc.setTextColor(WHITE[0], WHITE[1], WHITE[2]);
            txt('RÉCAPITULATIF', BX + BW / 2, y + 5.5, { align: 'center' });
            y += 8;

            const totLines = [
                ['Total heures',      document.getElementById('weekHours')?.textContent     || '—'],
                ['Kilomètres',        (document.getElementById('weekKm')?.textContent       || '0') + ' km'],
                ['Repas remboursés',  document.getElementById('weekMeals')?.textContent     || '0'],
                ['Total frais',       (document.getElementById('weekExpenses')?.textContent || '0.00') + ' CHF'],
            ];

            const totBlockStartY = y;
            totLines.forEach(([lbl, val], idx) => {
                const bg = idx % 2 === 0 ? LGREY : WHITE;
                fillRect(BX, y, BW, TRWH, bg);
                hLine(y + TRWH, BX, BX + BW, MGREY, 0.15);

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(MID[0], MID[1], MID[2]);
                txt(lbl, BX + 4, y + TRWH - 2);

                doc.setFont('helvetica', 'bold');
                doc.setTextColor(RED[0], RED[1], RED[2]);
                txt(val, BX + BW - 4, y + TRWH - 2, { align: 'right' });
                y += TRWH;
            });
            // Bordure extérieure du bloc totaux
            strokeRect(BX, totBlockStartY - 8, BW, totLines.length * TRWH + 8, DARK, 0.4);

            y += 10;

            // ── INFORMATIONS PERSONNELLES ─────────────────────────────
            const piRows = [
                ['Prénom / Nom', fullName],
                ['Adresse',      [addr, cityLine].filter(Boolean).join(', ')],
                ['Téléphone',    phone],
                ['Email',        email],
                ['Pays',         countryVal],
            ].filter(([, v]) => v && v.trim());

            if (piRows.length > 0) {
                const PIW = CW * 0.6;
                const PIH = piRows.length * 6 + 10;
                if (y + PIH + 6 > PH - FOOT) { doc.addPage(); pageNum++; y = 14; }

                fillRect(ML, y, PIW, PIH, [248, 249, 252]);
                strokeRect(ML, y, PIW, PIH, MGREY, 0.3);
                // Trait gauche coloré
                fillRect(ML, y, 3, PIH, [100, 120, 200]);

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(7.5);
                doc.setTextColor(MID[0], MID[1], MID[2]);
                txt('INFORMATIONS PERSONNELLES', ML + 7, y + 6);

                piRows.forEach(([lbl, val], idx) => {
                    const ry = y + 11 + idx * 6;
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(7.5);
                    doc.setTextColor(MID[0], MID[1], MID[2]);
                    txt(lbl, ML + 7, ry);
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                    txt(truncate(val, PIW - 50), ML + 40, ry);
                });
                y += PIH + 6;
            }

            // ── NOTES ─────────────────────────────────────────────────
            const notes = (document.getElementById('notes')?.value || '').trim();
            if (notes) {
                const noteLines = doc.splitTextToSize(notes, CW - 10);
                const noteH = noteLines.length * 4.5 + 12;
                if (y + noteH + 4 > PH - FOOT) { doc.addPage(); pageNum++; y = 14; }

                fillRect(ML, y, CW, noteH, LGREY);
                strokeRect(ML, y, CW, noteH, MGREY, 0.3);
                fillRect(ML, y, 3, noteH, [90, 90, 110]);

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(7.5);
                doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                txt('NOTES COMPLÉMENTAIRES', ML + 7, y + 6);

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(DARK[0], DARK[1], DARK[2]);
                txt(noteLines, ML + 7, y + 11);
                y += noteH + 4;
            }

            // ── PIED DE PAGE SUR TOUTES LES PAGES ────────────────────
            const totalPages = doc.internal.getNumberOfPages();
            for (let p = 1; p <= totalPages; p++) {
                doc.setPage(p);
                drawFooter(p, totalPages);
            }

            // ── TÉLÉCHARGEMENT ────────────────────────────────────────
            const safeName    = name.replace(/\s+/g, '_');
            const safeCompany = company.replace(/\s+/g, '_');
            const safeDate    = formatDateFull(currentWeekStart).replace(/\//g, '-');
            doc.save(`${safeCompany}_${safeName}_${safeDate}.pdf`);

            // Feedback bouton
            const btn = event.target;
            const orig = btn.textContent;
            btn.textContent = '✓';
            setTimeout(() => { btn.textContent = orig; }, 1500);
        }
        // Nom entreprise
        function saveCompanyName() {
            localStorage.setItem('companyName', document.getElementById('companyName').value);
        }

        function loadCompanyName() {
            const saved = localStorage.getItem('companyName');
            if (saved) document.getElementById('companyName').value = saved;
        }

        // ── Init avec restauration IndexedDB automatique ──
        MesHeuresDB.restoreIfNeeded().then(wasRestored => {
            loadCompanyName();
            renderWeek();
            if (wasRestored) {
                // Toast discret 3 secondes
                setTimeout(() => {
                    MesHeuresDB.showToast('✓ Données récupérées automatiquement');
                }, 800);
            }
        }).catch(() => {
            // Fallback : lancer l'app normalement même si IDB échoue
            loadCompanyName();
            renderWeek();
        });

        // Scroll pour cacher/afficher le footer
        let lastScrollTop = 0;
        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const footer    = document.querySelector('.summary-footer');
            if (scrollTop > lastScrollTop && scrollTop > 60) {
                footer.classList.add('hidden');
            } else {
                footer.classList.remove('hidden');
            }
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }, { passive: true });

        // ============================================================
        // AUTOCOMPLETE UNIFIÉ — clients, descriptions, lieux
        // Architecture : une seule paire de fonctions génériques
        //   showAcSuggestions(input, type)  — affiche le dropdown
        //   hideAcSuggestions(input)        — masque le dropdown
        //   recordAc(type, value)           — enregistre dans l'historique
        //   openAcModal(type)               — modal de gestion
        //
        // Types : 'client' | 'desc' | 'lieu'
        // localStorage keys : 'acHistory_client' | 'acHistory_desc' | 'acHistory_lieu'
        //
        // Pour 'lieu' : fusion liste fixe COMMUNES (base) + historique utilisateur
        // Les entrées utilisateur ont priority; les communes de base complètent
        // jusqu'à MAX_ITEMS suggestions.
        // ============================================================

        // ── Liste fixe des communes du Jura bernois ──────────────────
        const COMMUNES_BASE = [
            'Porrentruy','Alle','Boncourt','Bressaucourt','Buix','Bure',
            'Chevenez','Coeuve','Cornol','Courgenay','Courtemautruy','Courchavon',
            'Damphreux','Damvant','Fahy','Fontenais','Grandfontaine','Lugnez',
            'Montignez','Mormont','Movelier','Ocourt','Pleigne','Réclère',
            'Rocourt','Saint-Ursanne','Seleute','Vendlincourt',
            'Delémont','Bassecourt','Boécourt','Bourrignon','Châtillon',
            'Courfaivre','Courtételle','Develier','Ederswiler','Glovelier',
            'Haute-Sorne','La Baroche','Les Genevez','Lajoux','Mettembert',
            'Mervelier','Miécourt','Rossemaison','Soyhières','Val Terbi','Vicques',
            'Saignelégier','Les Bois','Les Breuleux','Le Bémont','Le Noirmont',
            'Muriaux','La Chaux-des-Breuleux','Saint-Brais','Goumois',
            'Montfaucon','Les Enfers',
            'Moutier','Belprahon','Champoz','Corcelles','Court','Crémines',
            'Eschert','Grandval','Loveresse','Perrefitte','Pontenet',
            'Reconvilier','Roches','Saicourt','Sorvilier','Tavannes',
            'Bévilard','Malleray','Tramelan','Péry-La Heutte',
            'La Neuveville','Diesse','Lamboing','Prêles',
            'Saint-Imier','Courtelary','Cormoret','Cortébert','Corgémont',
            'Sonceboz-Sombeval','Villeret','Orvin','Péry','Plagne','Renan','Sonvilier',
            'Bienne','La Chaux-de-Fonds','Neuchâtel','Bâle','Berne','Soleure','Olten'
        ];

        const AC_MAX   = 20;  // max entrées historique utilisateur par type
        const AC_SHOW  = 6;   // max suggestions affichées dans le dropdown

        // ── Clés localStorage ────────────────────────────────────────
        function acKey(type) { return 'acHistory_' + type; }

        // ── Charger l'historique d'un type ───────────────────────────
        // Retourne : [{ name: string, count: number }, ...] trié par count desc
        function loadAcHistory(type) {
            try { return JSON.parse(localStorage.getItem(acKey(type)) || '[]'); }
            catch(e) { return []; }
        }

        // ── Enregistrer une valeur dans l'historique ─────────────────
        function recordAc(type, value) {
            value = (value || '').trim();
            if (!value || value.length < 2) return;
            let list = loadAcHistory(type);
            const idx = list.findIndex(e => e.name.toLowerCase() === value.toLowerCase());
            if (idx >= 0) {
                list[idx].count++;
                list[idx].name = value; // normalise la casse
            } else {
                list.push({ name: value, count: 1 });
            }
            list.sort((a, b) => b.count - a.count);
            list = list.slice(0, AC_MAX);
            localStorage.setItem(acKey(type), JSON.stringify(list));
        }

        // ── Construire la liste de suggestions pour un type + filtre ─
        // Retourne : [{ name, isBase, count }, ...]
        function buildSuggestions(type, val) {
            const history = loadAcHistory(type);
            val = (val || '').trim().toLowerCase();

            if (type === 'lieu') {
                // Utilisateur d'abord
                const userMatches = history
                    .filter(e => val === '' ? true : e.name.toLowerCase().includes(val))
                    .map(e => ({ name: e.name, count: e.count, isBase: false }));

                // Compléter avec les communes de base si on n'est pas encore à AC_SHOW
                const userNames = new Set(userMatches.map(e => e.name.toLowerCase()));
                const baseMatches = COMMUNES_BASE
                    .filter(c => (val === '' ? true : c.toLowerCase().startsWith(val))
                                 && !userNames.has(c.toLowerCase()))
                    .map(c => ({ name: c, count: 0, isBase: true }));

                return [...userMatches, ...baseMatches].slice(0, AC_SHOW);
            }

            // client ou desc : historique utilisateur uniquement
            return history
                .filter(e => val === '' ? true : e.name.toLowerCase().includes(val))
                .slice(0, AC_SHOW)
                .map(e => ({ name: e.name, count: e.count, isBase: false }));
        }

        // ── Trouver le dropdown .ac-suggestions dans le bon wrapper ──
        function getAcDropdown(input) {
            return input.closest('.ac-wrapper')?.querySelector('.ac-suggestions')
                || input.closest('.client-input-wrapper')?.querySelector('.client-suggestions')
                || input.closest('.lieu-wrapper')?.querySelector('.lieu-suggestions')
                || null;
        }

        // ── Afficher le dropdown ─────────────────────────────────────
        function showAcSuggestions(input, type) {
            const dropdown = getAcDropdown(input);
            if (!dropdown) return;
            const val = input.value;
            dropdown.innerHTML = '';

            const suggestions = buildSuggestions(type, val);
            if (suggestions.length === 0) { dropdown.classList.remove('visible'); return; }

            suggestions.forEach(({ name, isBase }) => {
                const item = document.createElement('div');
                item.className = 'ac-item' + (isBase ? ' ac-base' : ' ac-user');

                const badge = '';  // pas de badge de source
                // Bouton × seulement pour l'historique utilisateur
                const del = !isBase
                    ? `<span class="ac-item-del" title="Retirer">×</span>`
                    : '';
                item.innerHTML = `${badge}<span class="ac-item-name">${name}</span>${del}`;

                // Sélection du nom
                const nameFn = e => {
                    e.preventDefault();
                    input.value = name;
                    dropdown.classList.remove('visible');
                    if (!isBase) recordAc(type, name); // renforce le score
                    input.dispatchEvent(new Event('change'));
                };
                const nameEl = item.querySelector('.ac-item-name');
                nameEl.addEventListener('mousedown', nameFn);
                nameEl.addEventListener('touchstart', e => { e.preventDefault(); nameFn(e); }, { passive: false });

                // Suppression de l'entrée utilisateur
                const delEl = item.querySelector('.ac-item-del');
                if (delEl) {
                    const delFn = e => {
                        e.preventDefault();
                        e.stopPropagation();
                        let list = loadAcHistory(type).filter(entry => entry.name !== name);
                        localStorage.setItem(acKey(type), JSON.stringify(list));
                        showAcSuggestions(input, type); // rafraîchir
                    };
                    delEl.addEventListener('mousedown', delFn);
                    delEl.addEventListener('touchstart', e => { e.preventDefault(); delFn(e); }, { passive: false });
                }

                dropdown.appendChild(item);
            });
            dropdown.classList.add('visible');
        }

        // ── Cacher le dropdown ───────────────────────────────────────
        function hideAcSuggestions(input) {
            setTimeout(() => {
                const dropdown = getAcDropdown(input);
                if (dropdown) dropdown.classList.remove('visible');
            }, 180);
        }

        // ── Compatibilité : anciennes fonctions pointent vers le moteur unifié ─
        function showClientSuggestions(input) { showAcSuggestions(input, 'client'); }
        function hideClientSuggestions(input) { hideAcSuggestions(input); }
        function showLieuSuggestions(input)   { showAcSuggestions(input, 'lieu'); }
        function hideLieuSuggestions(input)   { hideAcSuggestions(input); }
        function recordClient(name)           { recordAc('client', name); }
        // Charger l'ancien clientHistory et migrer vers le nouveau format si nécessaire
        (function migrateClientHistory() {
            const old = localStorage.getItem('clientHistory');
            if (!old) return;
            try {
                const parsed = JSON.parse(old);
                if (Array.isArray(parsed) && parsed.length > 0 && !localStorage.getItem('acHistory_client')) {
                    localStorage.setItem('acHistory_client', old);
                }
            } catch(e) {}
            // Ne pas effacer l'ancienne clé pour rétrocompat
        })();

        // ── Modal de gestion ─────────────────────────────────────────
        // type = 'client' | 'desc' | 'lieu'
        const AC_MODAL_LABELS = {
            client: { title: 'Clients enregistrés',      subtitle: 'Appuyez sur × pour retirer un client.' },
            desc:   { title: 'Descriptions enregistrées', subtitle: 'Appuyez sur × pour retirer une description.' },
            lieu:   { title: 'Lieux enregistrés',         subtitle: 'Seuls vos lieux saisis apparaissent ici. Les communes de base sont toujours disponibles.' },
        };
        let _acModalType = 'client';

        function openAcModal(type) {
            _acModalType = type || 'client';
            const labels = AC_MODAL_LABELS[_acModalType] || AC_MODAL_LABELS.client;
            const listEl = document.getElementById('acModalList');
            const titleEl = document.getElementById('acModalTitle');
            const subEl   = document.getElementById('acModalSubtitle');
            if (!listEl) return;

            if (titleEl) titleEl.textContent = labels.title;
            if (subEl)   subEl.textContent   = labels.subtitle;

            listEl.innerHTML = '';
            const history = loadAcHistory(_acModalType);

            // Pour lieu : on n'affiche dans la modal que l'historique user (pas les communes de base)
            const items = history; // déjà filtré (pas de communes base dans acHistory_lieu)

            if (items.length === 0) {
                listEl.innerHTML = '<div class="clients-modal-empty">Aucune entrée enregistrée.</div>';
            } else {
                items.forEach(({ name, count }) => {
                    const row = document.createElement('div');
                    row.className = 'clients-modal-item';
                    const safeName = name.replace(/'/g, "\\'");
                    row.innerHTML = `
                        <span class="clients-modal-item-name">${name}</span>
                        <span class="clients-modal-item-count">${count} fois</span>
                        <button class="clients-modal-del" data-delete-ac="${safeName}">×</button>
                    `;
                    listEl.appendChild(row);
                });
            }
            document.getElementById('acModalOverlay').classList.add('open');
        }

        function deleteAcFromModal(name) {
            let list = loadAcHistory(_acModalType).filter(e => e.name !== name);
            localStorage.setItem(acKey(_acModalType), JSON.stringify(list));
            openAcModal(_acModalType);
        }

        function closeAcModal() {
            document.getElementById('acModalOverlay').classList.remove('open');
        }

        // Rétrocompat avec l'ancienne modal clients
        function openClientsModal()           { openAcModal('client'); }
        function deleteClientFromModal(name)  { deleteAcFromModal(name); }
        function closeClientsModal()          { closeAcModal(); }

        // ============================================================
        // BACKUP — Export / Import JSON de tout le localStorage
        // ============================================================
        function exportBackup() {
            const allData = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                allData[key] = localStorage.getItem(key);
            }
            const blob = new Blob([JSON.stringify(allData)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'mesheures_sauvegarde.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importBackup(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    Object.keys(data).forEach(key => {
                        localStorage.setItem(key, data[key]);
                    });
                    alert('Sauvegarde restaurée !');
                    location.reload();
                } catch(err) {
                    alert('Fichier invalide.');
                }
            };
            reader.readAsText(file);
        }

        document.getElementById('importFile').addEventListener('change', function() {
            if (this.files.length > 0) { importBackup(this.files[0]); }
        });


        // ============================================================
        // EVENT DELEGATION GLOBAL — remplace tous les onclick inline
        // ============================================================
        document.addEventListener('click', function(e) {
            const target = e.target.closest('button');

            // ── Spans cliquables (add-km-btn, add-expense-btn) ──────
            const span = e.target.closest('span.add-km-btn, span.add-expense-btn');
            if (span) {
                const day = parseInt(span.dataset.day);
                if (!isNaN(day)) {
                    if (span.matches('.add-km-btn'))      addKm(day);
                    if (span.matches('.add-expense-btn')) addExpense(day);
                }
                return;
            }

            if (!target) return;

            // Ajouter client supplémentaire
            if (target.matches('.add-client-line-btn')) {
                const day    = parseInt(target.dataset.day);
                const period = target.dataset.period;
                if (!isNaN(day) && period) addClientEntry(day, period);
            }

            // Navigation semaine
            if (target.matches('.week-prev')) changeWeek(-1);
            if (target.matches('.week-next')) changeWeek(1);

            // Navigation mois calendrier
            if (target.matches('.cal-prev-month')) {
                calendarViewMonth = new Date(calendarViewMonth.getFullYear(), calendarViewMonth.getMonth() - 1, 1);
                renderCalendar();
            }
            if (target.matches('.cal-next-month')) {
                calendarViewMonth = new Date(calendarViewMonth.getFullYear(), calendarViewMonth.getMonth() + 1, 1);
                renderCalendar();
            }
            // Navigation année calendrier
            if (target.matches('.cal-prev-year')) {
                calendarViewMonth = new Date(calendarViewMonth.getFullYear() - 1, calendarViewMonth.getMonth(), 1);
                renderCalendar();
            }
            if (target.matches('.cal-next-year')) {
                calendarViewMonth = new Date(calendarViewMonth.getFullYear() + 1, calendarViewMonth.getMonth(), 1);
                renderCalendar();
            }

            // Export / Effacer
            if (target.matches('.btn-export'))        exportToExcel();
            if (target.matches('.btn-pdf'))           exportToPDF();
            if (target.matches('.btn-clear'))         clearWeek();

            // Backup
            if (target.matches('.btn-backup-export')) exportBackup();
            if (target.matches('.btn-backup-import')) document.getElementById('importFile').click();

            // Time picker — mode heure/minute
            if (target.matches('[data-mode]')) switchMode(target.dataset.mode);

            // Time picker — annuler / OK
            if (target.matches('.time-btn-cancel')) closeTimePicker();
            if (target.matches('.time-btn-ok'))     confirmTime();

            // Inputs time readonly — ouvrir le picker
            // (géré via délégation sur document pour les inputs, pas les buttons)

            // Modal autocomplete — ouvrir
            if (target.matches('.ac-manage-btn')) {
                const modal = target.dataset.modal || 'client';
                openAcModal(modal);
            }

            // Modal autocomplete — fermer (bouton ×)
            if (target.matches('.clients-modal-close')) closeAcModal();

            // Modal autocomplete — supprimer une entrée
            if (target.matches('.clients-modal-del')) {
                const name = target.dataset.deleteAc;
                if (name) deleteAcFromModal(name);
            }

            // Supprimer un item km/frais (parentElement)
            if (target.matches('.remove-expense-btn')) {
                target.parentElement.remove();
                calculateTotals();
                saveAllData();
            }

            // Supprimer une client-entry
            if (target.matches('[data-action="remove-client"]')) {
                const entry = target.closest('.client-entry');
                if (entry) {
                    const card    = entry.closest('.day-card');
                    const cards   = Array.from(document.querySelectorAll('.day-card'));
                    const dayIdx  = cards.indexOf(card);
                    entry.remove();
                    saveAllData();
                    if (dayIdx >= 0) calculateDayHours(dayIdx);
                }
            }
        });

        // Inputs time readonly — délégation pour openCustomTimePicker
        document.addEventListener('click', function(e) {
            const input = e.target.closest('input[data-timepicker="true"]');
            if (input) openCustomTimePicker(input);
        });

        // Modal overlay — fermer en cliquant à l'extérieur
        document.addEventListener('click', function(e) {
            const overlay = document.getElementById('acModalOverlay');
            if (e.target === overlay) closeAcModal();
        });

        // ── Sélecteur mois / année ──────────────────────────────
        (function initCalPicker() {
            const overlay  = document.getElementById('calPickerOverlay');
            const selMonth = document.getElementById('calPickerMonth');
            const selYear  = document.getElementById('calPickerYear');
            const btnOk    = document.getElementById('calPickerConfirm');
            const btnCan   = document.getElementById('calPickerCancel');
            const header   = document.getElementById('calendarHeader');
            const thisYear = new Date().getFullYear();
            for (let y = thisYear - 3; y <= thisYear + 2; y++) {
                const opt = document.createElement('option');
                opt.value = y;
                opt.textContent = y;
                selYear.appendChild(opt);
            }
            header.addEventListener('click', () => {
                selMonth.value = calendarViewMonth.getMonth();
                selYear.value  = calendarViewMonth.getFullYear();
                overlay.classList.add('visible');
            });
            btnOk.addEventListener('click', () => {
                calendarViewMonth = new Date(parseInt(selYear.value), parseInt(selMonth.value), 1);
                overlay.classList.remove('visible');
                renderCalendar();
            });
            btnCan.addEventListener('click', () => overlay.classList.remove('visible'));
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) overlay.classList.remove('visible');
            });
        })();


        // ── Hook sur saveAllData — dupliquer vers IndexedDB ──────────
        // On enveloppe la fonction existante sans la remplacer
        (function patchSaveAllData() {
            const _orig = saveAllData;
            saveAllData = function() {
                _orig.apply(this, arguments);
                // Backup asynchrone silencieux ~100ms après
                setTimeout(() => MesHeuresDB.save(), 100);
            };
        })();

        // ── Curseur rouge "Entreprise" ───────────────────────────────
        // Attendre que les polices soient prêtes avant de positionner le curseur
        (document.fonts ? document.fonts.ready : Promise.resolve()).then(function() {
            const input  = document.getElementById('companyName');
            const cursor = document.getElementById('companyCursor');
            if (!input || !cursor) return;

            function measureText(txt, font) {
                const c = document.createElement('canvas');
                const ctx = c.getContext('2d');
                ctx.font = font;
                return ctx.measureText(txt).width;
            }

            function positionCursor() {
                const style  = window.getComputedStyle(input);
                const font   = style.fontWeight + ' ' + style.fontSize + ' ' + style.fontFamily;
                const txtW   = measureText('Entreprise', font);
                const inputW = input.offsetWidth;
                const leftPx = (inputW / 2) - (txtW / 2) - 6;
                cursor.style.left = Math.max(0, leftPx) + 'px';
            }

            function syncCursor() {
                const hide = input.value.trim() !== '' || document.activeElement === input;
                cursor.classList.toggle('hidden', hide);
                if (!hide) positionCursor();
            }

            input.addEventListener('focus',  syncCursor);
            input.addEventListener('blur',   syncCursor);
            input.addEventListener('input',  syncCursor);
            window.addEventListener('resize', () => { if (!cursor.classList.contains('hidden')) positionCursor(); });

            syncCursor();
        });

        // Sauvegarde automatique toutes les 2 minutes
        setInterval(saveAllData, 120000);
        window.addEventListener('beforeunload', saveAllData);

    </script>

    <div style="position:fixed;bottom:6px;right:10px;font-size:9px;color:#C7C7CC;font-family:'Poppins', sans-serif;pointer-events:none;z-index:50;">smims909</div>


    <!-- Modal gestion autocomplete (clients / descriptions / lieux) -->
    <div class="clients-modal-overlay" id="acModalOverlay">
        <div class="clients-modal" role="dialog" aria-modal="true" aria-label="Gestion des listes">
            <div class="clients-modal-header">
                <span class="clients-modal-title" id="acModalTitle">Liste enregistrée</span>
                <button class="clients-modal-close" aria-label="Fermer">×</button>
            </div>
            <div class="clients-modal-subtitle" id="acModalSubtitle"></div>
            <div id="acModalList"></div>
        </div>
    </div>

</body>
</html>